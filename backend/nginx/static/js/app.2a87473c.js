(function(e){function t(t){for(var s,o,i=t[0],c=t[1],u=t[2],d=0,m=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&m.push(a[o][0]),a[o]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(e[s]=c[s]);l&&l(t);while(m.length)m.shift()();return r.push.apply(r,u||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],s=!0,i=1;i<n.length;i++){var c=n[i];0!==a[c]&&(s=!1)}s&&(r.splice(t--,1),e=o(o.s=n[0]))}return e}var s={},a={app:0},r=[];function o(t){if(s[t])return s[t].exports;var n=s[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=s,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(n,s,function(t){return e[t]}.bind(null,s));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var l=c;r.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var s=n("85ec"),a=n.n(s);a.a},"17ac":function(e,t,n){"use strict";var s=n("57b0"),a=n.n(s);a.a},"363a":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t),n.d(t,"alertNotifierChannel",(function(){return z}));n("e260"),n("e6cf"),n("cca6"),n("a79d");var s=n("2b0e"),a=n("2f62"),r=(n("96cf"),n("1da1")),o=n("bc3a"),i=n.n(o),c=function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n,s,a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=l(t),e.next=3,i.a.get(n);case 3:return r=e.sent,s=r.data.data,a=r.data.status,console.log("GET: resultStatus: ",a),!0!==a&&(console.log(r),z.$emit("show",{duration:5,message:"Get request error"})),e.abrupt("return",s);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),u=function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n,s,a,r=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:null,s=l(t),e.next=4,i.a.post(s,n);case 4:return a=e.sent,console.log("POST: resultStatus: ",a.data.status),!0!==a.data.status&&(console.log("failed response: ",a),z.$emit("show",{duration:5,message:"Post request error"})),e.abrupt("return",a.data);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function l(e){return"/api/v1/"+e}var d={get:c,post:u};s["default"].use(a["a"]);var m=new a["a"].Store({state:{user:{username:"",email:"",contacts:[],chats:[{chat_id:"",name:"",usernames:"",admin:""}]},allUsers:[],socket:{isConnected:!1,message:"",reconnectError:!1}},getters:{GET_USER:function(e){return e.user},GET_ALL_USERS:function(e){return e.allUsers}},mutations:{SET_USER:function(e,t){e.user=t,console.log("User set: ",e.user)},SET_ALL_USERS:function(e,t){e.allUsers=t,console.log("All users set: ",e.allUsers)},SOCKET_ONOPEN:function(e,t){s["default"].prototype.$socket=t.currentTarget,e.socket.isConnected=!0},SOCKET_ONCLOSE:function(e,t){e.socket.isConnected=!1},SOCKET_ONERROR:function(e,t){console.error(e,t)},SOCKET_ONMESSAGE:function(e,t){console.log("Got message in store: ",t),e.socket.message=t},SOCKET_RECONNECT:function(e,t){console.info(e,t)},SOCKET_RECONNECT_ERROR:function(e){e.socket.reconnectError=!0}},actions:{LOAD_USER_DATA:function(e){var t=d.get("get_data");t.then((function(t){e.commit("SET_USER",t)}))},LOAD_ALL_USERS:function(e){var t=d.get("all_users");t.then((function(t){e.commit("SET_ALL_USERS",t)}))},SEND_MESSAGE:function(e,t){s["default"].prototype.$socket.send(t)},RECEIVE_MESSAGE:function(e,t){e.commit("SOCKET_ONMESSAGE",t)}}}),f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("Alert"),n("router-view")],1)},h=[],p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"form-container"},[n("label",{staticClass:"form-item"},[n("h3",[e._v("Name:")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.user.username,expression:"user.username"}],attrs:{type:"text",name:"username"},domProps:{value:e.user.username},on:{input:function(t){t.target.composing||e.$set(e.user,"username",t.target.value)}}})]),n("label",{staticClass:"form-item"},[n("h3",[e._v("Password:")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.user.password,expression:"user.password"}],attrs:{type:"password",name:"password"},domProps:{value:e.user.password},on:{input:function(t){t.target.composing||e.$set(e.user,"password",t.target.value)}}})]),n("div",{staticClass:"buttons-container"},[n("button",{on:{click:e.signIn}},[e._v("Sign In")]),n("button",{on:{click:e.signUp}},[e._v("Sign up")])])])])},g=[],v={name:"Login",data:function(){return{user:{username:"",password:""}}},methods:{signIn:function(){var e=this,t=d.post("signin",this.user);t.then((function(t){!0===t.status&&e.$router.push("/chat")}))},signUp:function(){var e=this,t=d.post("signup",this.user);t.then((function(t){!0===t.status&&e.$router.push("/chat")}))}}},_=v,E=(n("17ac"),n("2877")),S=Object(E["a"])(_,p,g,!1,null,"88c63678",null),b=S.exports,w=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.isActive?n("div",{staticClass:"alert-container"},[n("h3",[e._v(e._s(e.message))])]):e._e()},C=[],O={name:"Alert",data:function(){return{message:"",isActive:!1}},created:function(){var e=this;z.$on("show",(function(t){e.isActive=!0,e.message=t.message}))}},T=O,y=(n("810c"),Object(E["a"])(T,w,C,!1,null,"1379974a",null)),x=y.exports,A={name:"App",components:{Alert:x,Login:b}},R=A,U=(n("034f"),Object(E["a"])(R,f,h,!1,null,null,null)),$=U.exports,D=(n("f9e3"),n("2dd8"),n("8c4f")),N=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h3",[e._v(e._s(e.chat.name))]),n("div",{staticClass:"chatroom-container"},[n("div",{staticClass:"sidebar-container"},[n("b-button",{directives:[{name:"b-toggle",rawName:"v-b-toggle.sidebar-1",modifiers:{"sidebar-1":!0}}],staticClass:"main-info-button",attrs:{size:"lg",variant:"primary"}},[n("b-icon-chat-dots")],1),n("b-sidebar",{attrs:{id:"sidebar-1",title:e.userData.username,shadow:""}},[n("div",{staticClass:"sidebar-content"},[n("div",{staticClass:"contacts-container"},[n("h4",[e._v("My chats:")]),e._l(e.userData.chats,(function(t){return n("div",{key:t.chat_id,staticClass:"chat-item",on:{click:function(n){return e.setExistingChat(t)}}},[n("h5",[e._v(e._s(t.name))])])}))],2),n("div",{staticClass:"contacts-container"},[n("h4",[e._v("All users:")]),e._l(e.newUsers,(function(t){return n("p",{key:t.username,on:{click:function(n){return e.setNewChat(t)}}},[e._v(e._s(t.username))])}))],2)])])],1),n("div",{staticClass:"chat-screen"},[e._l(e.messages,(function(t){return n("div",{key:t.date,class:(t.sender===e.userData.username?"right-message":"left-message")+" message-container"},[n("div",{staticClass:"message-header"},[n("div",{staticClass:"message-sender"},[e._v(" "+e._s(t.sender)+" ")]),n("div",{staticClass:"message-date"},[e._v(" "+e._s(e.convertToDatetime(t.date))+" ")])]),n("div",{staticClass:"message-text"},[e._v(e._s(t.text))])])})),n("div",{staticClass:"input-container"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.messageText,expression:"messageText"}],staticClass:"message-input",attrs:{type:"text"},domProps:{value:e.messageText},on:{input:function(t){t.target.composing||(e.messageText=t.target.value)}}}),n("button",{on:{click:e.sendMessage}},[e._v("Send")])])],2)])])},k=[],L=(n("4de4"),n("4160"),n("caad"),n("b0c0"),n("2532"),n("159b"),{name:"Chat",data:function(){return{chat:{chat_id:null,name:"",usernames:[],admin:""},messages:[],messageText:""}},created:function(){this.$store.dispatch("LOAD_USER_DATA"),this.$store.dispatch("LOAD_ALL_USERS"),this.connection=this.setConnection()},methods:{sendMessage:function(){var e={sender:this.userData.username,chat_id:this.chat.chat_id,meta:this.chat.name,date:Date.now(),state:0,text:this.messageText,attached_file_path:null};console.log("Message to send: ",e),this.messageText="",this.$store.dispatch("SEND_MESSAGE",JSON.stringify(e))},setConnection:function(){var e=this;this.$connect(),this.$options.sockets.onmessage=function(t){var n=JSON.parse(t.data);e.$store.dispatch("RECEIVE_MESSAGE",n),e.messages.push(n)}},setExistingChat:function(e){this.chat=e;var t=d.get("get_messages/"+e.chat_id),n=this;this.messages=[],t.then((function(e){void 0!==e&&0!==e.length&&e.forEach((function(e){n.messages.push(e)}))}))},setNewChat:function(e){this.chat={chat_id:null,name:e.username,usernames:[e.username,this.userData.username],admin:this.userData.username},this.messages=[]},convertToDatetime:function(e){var t=new Date(e),n=t.getHours(),s="0"+t.getMinutes(),a="0"+t.getSeconds();return n+":"+s.substr(-2)+":"+a.substr(-2)}},computed:{userData:function(){return this.$store.getters.GET_USER},allUsers:function(){return this.$store.getters.GET_ALL_USERS},newUsers:function(){var e=this;return this.$store.getters.GET_ALL_USERS.filter((function(t){return t.username!==e.userData.username&&(null==e.userData.contacts||!e.userData.contacts.includes(t.username))}))}}}),M=L,j=(n("571d"),Object(E["a"])(M,N,k,!1,null,"6ad98fc4",null)),G=j.exports;s["default"].use(D["a"]);var P=[{path:"/",redirect:"/home"},{path:"/login",redirect:"/home"},{path:"/home",name:"home_page",meta:{title:"Home page"},component:b},{path:"/chat",name:"chat_page",meta:{title:"Chat page"},component:G}],K=new D["a"]({mode:"history",base:"/",routes:P}),I=K,J=n("5f5b"),q=n("b1e0"),H=n("b408"),V=n.n(H);s["default"].use(V.a,"ws://"+window.location.host+"/ws/connect",{connectManually:!0,reconnection:!0,reconnectionAttempts:5},{store:m}),s["default"].use(J["a"]),s["default"].use(q["a"]),s["default"].config.productionTip=!1;var z=new s["default"];new s["default"]({store:m,router:I,render:function(e){return e($)}}).$mount("#app")},"571d":function(e,t,n){"use strict";var s=n("79b4"),a=n.n(s);a.a},"57b0":function(e,t,n){},"79b4":function(e,t,n){},"810c":function(e,t,n){"use strict";var s=n("363a"),a=n.n(s);a.a},"85ec":function(e,t,n){}});
//# sourceMappingURL=app.2a87473c.js.map