(function(e){function t(t){for(var n,o,i=t[0],u=t[1],c=t[2],d=0,m=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&m.push(a[o][0]),a[o]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n]);l&&l(t);while(m.length)m.shift()();return r.push.apply(r,c||[]),s()}function s(){for(var e,t=0;t<r.length;t++){for(var s=r[t],n=!0,i=1;i<s.length;i++){var u=s[i];0!==a[u]&&(n=!1)}n&&(r.splice(t--,1),e=o(o.s=s[0]))}return e}var n={},a={app:0},r=[];function o(t){if(n[t])return n[t].exports;var s=n[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=n,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(s,n,function(t){return e[t]}.bind(null,n));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],u=i.push.bind(i);i.push=t,i=i.slice();for(var c=0;c<i.length;c++)t(i[c]);var l=u;r.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"034f":function(e,t,s){"use strict";var n=s("85ec"),a=s.n(n);a.a},"17ac":function(e,t,s){"use strict";var n=s("57b0"),a=s.n(n);a.a},"363a":function(e,t,s){},"56d7":function(e,t,s){"use strict";s.r(t),s.d(t,"alertNotifierChannel",(function(){return W}));s("e260"),s("e6cf"),s("cca6"),s("a79d");var n=s("2b0e"),a=s("2f62"),r=(s("96cf"),s("1da1")),o=s("bc3a"),i=s.n(o),u=function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var s,n,a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=l(t),e.next=3,i.a.get(s);case 3:return r=e.sent,n=r.data.data,a=r.data.status,console.log("GET: resultStatus: ",a),!0!==a&&(console.log(r),W.$emit("show",{duration:5,message:"Get request error"})),e.abrupt("return",n);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c=function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var s,n,a,r=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=r.length>1&&void 0!==r[1]?r[1]:null,n=l(t),e.next=4,i.a.post(n,s);case 4:return a=e.sent,console.log("POST: resultStatus: ",a.data.status),!0!==a.data.status&&(console.log("failed response: ",a),W.$emit("show",{duration:5,message:"Post request error"})),e.abrupt("return",a.data);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function l(e){return"/api/v1/"+e}var d={get:u,post:c};n["default"].use(a["a"]);var m=new a["a"].Store({state:{user:{username:"",email:"",contacts:[],chats:[{chat_id:"",name:"",usernames:"",admin:""}]},allUsers:[]},getters:{GET_USER:function(e){return e.user},GET_ALL_USERS:function(e){return e.allUsers}},mutations:{SET_USER:function(e,t){e.user=t,console.log("User set: ",e.user)},SET_ALL_USERS:function(e,t){e.allUsers=t,console.log("All users set: ",e.allUsers)}},actions:{LOAD_USER_DATA:function(e){var t=d.get("get_data");t.then((function(t){e.commit("SET_USER",t)}))},LOAD_ALL_USERS:function(e){var t=d.get("all_users");t.then((function(t){e.commit("SET_ALL_USERS",t)}))}}}),f=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("Alert"),s("router-view")],1)},h=[],p=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"form-container"},[s("label",{staticClass:"form-item"},[s("h3",[e._v("Name:")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.user.username,expression:"user.username"}],attrs:{type:"text",name:"username"},domProps:{value:e.user.username},on:{input:function(t){t.target.composing||e.$set(e.user,"username",t.target.value)}}})]),s("label",{staticClass:"form-item"},[s("h3",[e._v("Password:")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.user.password,expression:"user.password"}],attrs:{type:"password",name:"password"},domProps:{value:e.user.password},on:{input:function(t){t.target.composing||e.$set(e.user,"password",t.target.value)}}})]),s("div",{staticClass:"buttons-container"},[s("button",{on:{click:e.signIn}},[e._v("Sign In")]),s("button",{on:{click:e.signUp}},[e._v("Sign up")])])])])},g=[],v={name:"Login",data:function(){return{user:{username:"",password:""}}},methods:{signIn:function(){var e=this,t=d.post("signin",this.user);t.then((function(t){!0===t.status&&e.$router.push("/chat")}))},signUp:function(){var e=this,t=d.post("signup",this.user);t.then((function(t){!0===t.status&&e.$router.push("/chat")}))}}},_=v,b=(s("17ac"),s("2877")),w=Object(b["a"])(_,p,g,!1,null,"88c63678",null),S=w.exports,y=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isActive?s("div",{staticClass:"alert-container"},[s("h3",[e._v(e._s(e.message))])]):e._e()},E=[],x={name:"Alert",data:function(){return{message:"",isActive:!1}},created:function(){var e=this;W.$on("show",(function(t){e.isActive=!0,e.message=t.message}))}},C=x,T=(s("810c"),Object(b["a"])(C,y,E,!1,null,"1379974a",null)),O=T.exports,A={name:"App",components:{Alert:O,Login:S}},U=A,D=(s("034f"),Object(b["a"])(U,f,h,!1,null,null,null)),L=D.exports,R=(s("f9e3"),s("2dd8"),s("8c4f")),$=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("h3",[e._v(e._s(e.chat.name))]),s("div",{staticClass:"chatroom-container"},[s("div",{staticClass:"sidebar-container"},[s("b-button",{directives:[{name:"b-toggle",rawName:"v-b-toggle.sidebar-1",modifiers:{"sidebar-1":!0}}],staticClass:"main-info-button",attrs:{size:"lg",variant:"primary"}},[s("b-icon-chat-dots")],1),s("b-sidebar",{attrs:{id:"sidebar-1",title:e.userData.username,shadow:""}},[s("div",{staticClass:"sidebar-content"},[s("div",{staticClass:"contacts-container"},[s("h4",[e._v("My chats:")]),e._l(e.userData.chats,(function(t){return s("div",{key:t.chat_id,staticClass:"chat-item",on:{click:function(s){return e.setExistingChat(t)}}},[s("h5",[e._v(e._s(t.name))])])}))],2),s("div",{staticClass:"contacts-container"},[s("h4",[e._v("All users:")]),e._l(e.newUsers,(function(t){return s("p",{key:t.username,on:{click:function(s){return e.setNewChat(t)}}},[e._v(e._s(t.username))])}))],2)])])],1),s("div",{staticClass:"chat-screen"},[e._l(e.messages,(function(t){return s("div",{key:t.date,class:(t.sender===e.userData.username?"right-message":"left-message")+" message-container"},[s("div",{staticClass:"message-header"},[s("div",{staticClass:"message-sender"},[e._v(" "+e._s(t.sender)+" ")]),s("div",{staticClass:"message-date"},[e._v(" "+e._s(e.convertToDatetime(t.date))+" ")])]),s("div",{staticClass:"message-text"},[e._v(e._s(t.text))])])})),s("div",{staticClass:"input-container"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.messageText,expression:"messageText"}],staticClass:"message-input",attrs:{type:"text"},domProps:{value:e.messageText},on:{input:function(t){t.target.composing||(e.messageText=t.target.value)}}}),s("button",{on:{click:e.sendMessage}},[e._v("Send")])])],2)])])},k=[],j=(s("4de4"),s("4160"),s("caad"),s("b0c0"),s("2532"),s("159b"),{name:"Chat",data:function(){return{chat:{chat_id:null,name:"",usernames:[],admin:""},messages:[],messageText:"",connection:{}}},created:function(){this.$store.dispatch("LOAD_USER_DATA"),this.$store.dispatch("LOAD_ALL_USERS"),this.connection=this.setConnection()},methods:{sendMessage:function(){var e={sender:this.userData.username,chat_id:this.chat.chat_id,meta:this.chat.name,date:Date.now(),state:0,text:this.messageText,attached_file_path:null};console.log("Message to send: ",e),this.connection.send(JSON.stringify(e)),this.messageText="",this.messages.push(e)},setConnection:function(){var e=this;if(window["WebSocket"]){var t=new WebSocket("ws://"+window.location.host+"/ws/connect");return t.onclose=function(){console.log("Connection closed")},t.onmessage=function(t){console.log("Got message: ",t);var s=JSON.parse(t.data);console.log("Body: ",s),s.sender!==e.$store.getters.GET_USER.username&&e.messages.push(s)},setInterval((function(){return t.send(JSON.stringify({meta:"pong"}))}),2e4),t}alert("You are a fucking looser, your browser does not support websockets")},setExistingChat:function(e){this.chat=e;var t=d.get("get_messages/"+e.chat_id),s=this;this.messages=[],t.then((function(e){void 0!==e&&0!==e.length&&e.forEach((function(e){s.messages.push(e)}))}))},setNewChat:function(e){this.chat={chat_id:null,name:e.username,usernames:[e.username,this.userData.username],admin:this.userData.username},this.messages=[]},convertToDatetime:function(e){var t=new Date(e),s=t.getHours(),n="0"+t.getMinutes(),a="0"+t.getSeconds();return s+":"+n.substr(-2)+":"+a.substr(-2)}},computed:{userData:function(){return this.$store.getters.GET_USER},allUsers:function(){return this.$store.getters.GET_ALL_USERS},newUsers:function(){var e=this;return this.$store.getters.GET_ALL_USERS.filter((function(t){return t.username!==e.userData.username&&(null==e.userData.contacts||!e.userData.contacts.includes(t.username))}))}}}),P=j,N=(s("feea"),Object(b["a"])(P,$,k,!1,null,"32d652fa",null)),G=N.exports;n["default"].use(R["a"]);var M=[{path:"/",redirect:"/home"},{path:"/login",redirect:"/home"},{path:"/home",name:"home_page",meta:{title:"Home page"},component:S},{path:"/chat",name:"chat_page",meta:{title:"Chat page"},component:G}],J=new R["a"]({mode:"history",base:"/",routes:M}),I=J,q=s("5f5b"),H=s("b1e0");n["default"].use(q["a"]),n["default"].use(H["a"]),n["default"].config.productionTip=!1;var W=new n["default"];new n["default"]({store:m,router:I,render:function(e){return e(L)}}).$mount("#app")},"57b0":function(e,t,s){},"810c":function(e,t,s){"use strict";var n=s("363a"),a=s.n(n);a.a},"85ec":function(e,t,s){},a89f:function(e,t,s){},feea:function(e,t,s){"use strict";var n=s("a89f"),a=s.n(n);a.a}});
//# sourceMappingURL=app.7366d229.js.map