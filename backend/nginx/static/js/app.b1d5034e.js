(function(e){function t(t){for(var s,o,i=t[0],u=t[1],c=t[2],d=0,m=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&m.push(a[o][0]),a[o]=0;for(s in u)Object.prototype.hasOwnProperty.call(u,s)&&(e[s]=u[s]);l&&l(t);while(m.length)m.shift()();return r.push.apply(r,c||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],s=!0,i=1;i<n.length;i++){var u=n[i];0!==a[u]&&(s=!1)}s&&(r.splice(t--,1),e=o(o.s=n[0]))}return e}var s={},a={app:0},r=[];function o(t){if(s[t])return s[t].exports;var n=s[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=s,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(n,s,function(t){return e[t]}.bind(null,s));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],u=i.push.bind(i);i.push=t,i=i.slice();for(var c=0;c<i.length;c++)t(i[c]);var l=u;r.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var s=n("85ec"),a=n.n(s);a.a},"17ac":function(e,t,n){"use strict";var s=n("57b0"),a=n.n(s);a.a},"363a":function(e,t,n){},"44e5":function(e,t,n){"use strict";var s=n("53f5"),a=n.n(s);a.a},"53f5":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t),n.d(t,"alertNotifierChannel",(function(){return W}));n("e260"),n("e6cf"),n("cca6"),n("a79d");var s=n("2b0e"),a=n("2f62"),r=(n("96cf"),n("1da1")),o=n("bc3a"),i=n.n(o),u=function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n,s,a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=l(t),e.next=3,i.a.get(n);case 3:return r=e.sent,s=r.data.data,a=r.data.status,console.log("GET: resultStatus: ",a),!0!==a&&(console.log(r),W.$emit("show",{duration:5,message:"Get request error"})),e.abrupt("return",s);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c=function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n,s,a,r=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:null,s=l(t),e.next=4,i.a.post(s,n);case 4:return a=e.sent,console.log("POST: resultStatus: ",a.data.status),!0!==a.data.status&&(console.log("failed response: ",a),W.$emit("show",{duration:5,message:"Post request error"})),e.abrupt("return",a.data);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function l(e){return"/api/v1/"+e}var d={get:u,post:c};s["default"].use(a["a"]);var m=new a["a"].Store({state:{user:{username:"",email:"",contacts:[],chats:[{chat_id:"",name:"",usernames:"",admin:""}]},allUsers:[]},getters:{GET_USER:function(e){return e.user},GET_ALL_USERS:function(e){return e.allUsers}},mutations:{SET_USER:function(e,t){e.user=t,console.log("User set: ",e.user)},SET_ALL_USERS:function(e,t){e.allUsers=t,console.log("All users set: ",e.allUsers)}},actions:{LOAD_USER_DATA:function(e){var t=d.get("get_data");t.then((function(t){e.commit("SET_USER",t)}))},LOAD_ALL_USERS:function(e){var t=d.get("all_users");t.then((function(t){e.commit("SET_ALL_USERS",t)}))}}}),f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("Alert"),n("router-view")],1)},h=[],p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"form-container"},[n("label",{staticClass:"form-item"},[n("h3",[e._v("Name:")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.user.username,expression:"user.username"}],attrs:{type:"text",name:"username"},domProps:{value:e.user.username},on:{input:function(t){t.target.composing||e.$set(e.user,"username",t.target.value)}}})]),n("label",{staticClass:"form-item"},[n("h3",[e._v("Password:")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.user.password,expression:"user.password"}],attrs:{type:"password",name:"password"},domProps:{value:e.user.password},on:{input:function(t){t.target.composing||e.$set(e.user,"password",t.target.value)}}})]),n("div",{staticClass:"buttons-container"},[n("button",{on:{click:e.signIn}},[e._v("Sign In")]),n("button",{on:{click:e.signUp}},[e._v("Sign up")])])])])},g=[],v={name:"Login",data:function(){return{user:{username:"",password:""}}},methods:{signIn:function(){var e=this,t=d.post("signin",this.user);t.then((function(t){!0===t.status&&e.$router.push("/chat")}))},signUp:function(){var e=this,t=d.post("signup",this.user);t.then((function(t){!0===t.status&&e.$router.push("/chat")}))}}},_=v,b=(n("17ac"),n("2877")),w=Object(b["a"])(_,p,g,!1,null,"88c63678",null),S=w.exports,y=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.isActive?n("div",{staticClass:"alert-container"},[n("h3",[e._v(e._s(e.message))])]):e._e()},E=[],x={name:"Alert",data:function(){return{message:"",isActive:!1}},created:function(){var e=this;W.$on("show",(function(t){e.isActive=!0,e.message=t.message}))}},C=x,T=(n("810c"),Object(b["a"])(C,y,E,!1,null,"1379974a",null)),O=T.exports,A={name:"App",components:{Alert:O,Login:S}},U=A,D=(n("034f"),Object(b["a"])(U,f,h,!1,null,null,null)),L=D.exports,k=(n("f9e3"),n("2dd8"),n("8c4f")),R=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h3",[e._v(e._s(e.chat.name))]),n("div",{staticClass:"chatroom-container"},[n("div",{staticClass:"sidebar-container"},[n("b-button",{directives:[{name:"b-toggle",rawName:"v-b-toggle.sidebar-1",modifiers:{"sidebar-1":!0}}],staticClass:"main-info-button",attrs:{size:"lg",variant:"primary"}},[n("b-icon-chat-dots")],1),n("b-sidebar",{attrs:{id:"sidebar-1",title:e.userData.username,shadow:""}},[n("div",{staticClass:"sidebar-content"},[n("div",{staticClass:"contacts-container"},[n("h4",[e._v("My chats:")]),e._l(e.userData.chats,(function(t){return n("p",{key:t.chat_id,on:{click:function(n){return e.setExistingChat(t)}}},[e._v(e._s(t.name))])})),e._l(e.userData.chats,(function(t){return n("div",{key:t.chat_id,staticClass:"chat-item",on:{click:function(n){return e.setExistingChat(t)}}},[n("div",[e._v(e._s(t.usernames.filter((function(t){return t!==e.userData.username})).join(", ")))])])}))],2),n("div",{staticClass:"contacts-container"},[n("h4",[e._v("All users:")]),e._l(e.newUsers,(function(t){return n("p",{key:t.username,on:{click:function(n){return e.setNewChat(t)}}},[e._v(e._s(t.username))])}))],2)])])],1),n("div",{staticClass:"chat-screen"},[e._l(e.messages,(function(t){return n("div",{key:t.date,class:(t.sender===e.userData.username?"right-message":"left-message")+" message-container"},[n("div",{staticClass:"message-header"},[n("div",{staticClass:"message-sender"},[e._v(" "+e._s(t.sender)+" ")]),n("div",{staticClass:"message-date"},[e._v(" "+e._s(e.convertToDatetime(t.date))+" ")])]),n("div",{staticClass:"message-text"},[e._v(e._s(t.text))])])})),n("div",{staticClass:"input-container"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.messageText,expression:"messageText"}],staticClass:"message-input",attrs:{type:"text"},domProps:{value:e.messageText},on:{input:function(t){t.target.composing||(e.messageText=t.target.value)}}}),n("button",{on:{click:e.sendMessage}},[e._v("Send")])])],2)])])},$=[],j=(n("4de4"),n("4160"),n("caad"),n("b0c0"),n("2532"),n("159b"),{name:"Chat",data:function(){return{chat:{chat_id:null,name:"",usernames:[],admin:""},messages:[],messageText:"",connection:{}}},created:function(){this.$store.dispatch("LOAD_USER_DATA"),this.$store.dispatch("LOAD_ALL_USERS"),this.connection=this.setConnection()},methods:{sendMessage:function(){var e={sender:this.userData.username,chat_id:this.chat.chat_id,meta:this.chat.name,date:Date.now(),state:0,text:this.messageText,attached_file_path:null};console.log("Message to send: ",e),this.connection.send(JSON.stringify(e)),this.messageText="",this.messages.push(e)},setConnection:function(){var e=this;if(window["WebSocket"]){var t=new WebSocket("ws://"+window.location.host+"/ws/connect");return t.onclose=function(){console.log("Connection closed")},t.onmessage=function(t){console.log("Got message: ",t);var n=JSON.parse(t.data);console.log("Body: ",n),n.sender!==e.$store.getters.GET_USER.username&&e.messages.push(n)},setInterval((function(){return t.send(JSON.stringify({meta:"pong"}))}),2e4),t}alert("You are a fucking looser, your browser does not support websockets")},setExistingChat:function(e){this.chat=e;var t=d.get("get_messages/"+e.chat_id),n=this;this.messages=[],t.then((function(e){void 0!==e&&0!==e.length&&e.forEach((function(e){n.messages.push(e)}))}))},setNewChat:function(e){this.chat={chat_id:null,name:e.username,usernames:[e.username,this.userData.username],admin:this.userData.username},this.messages=[]},convertToDatetime:function(e){var t=new Date(e),n=t.getHours(),s="0"+t.getMinutes(),a="0"+t.getSeconds();return n+":"+s.substr(-2)+":"+a.substr(-2)}},computed:{userData:function(){return this.$store.getters.GET_USER},allUsers:function(){return this.$store.getters.GET_ALL_USERS},newUsers:function(){var e=this;return this.$store.getters.GET_ALL_USERS.filter((function(t){return t.username!==e.userData.username&&(null==e.userData.contacts||!e.userData.contacts.includes(t.username))}))}}}),P=j,N=(n("44e5"),Object(b["a"])(P,R,$,!1,null,"313da904",null)),G=N.exports;s["default"].use(k["a"]);var M=[{path:"/",redirect:"/home"},{path:"/login",redirect:"/home"},{path:"/home",name:"home_page",meta:{title:"Home page"},component:S},{path:"/chat",name:"chat_page",meta:{title:"Chat page"},component:G}],J=new k["a"]({mode:"history",base:"/",routes:M}),I=J,q=n("5f5b"),H=n("b1e0");s["default"].use(q["a"]),s["default"].use(H["a"]),s["default"].config.productionTip=!1;var W=new s["default"];new s["default"]({store:m,router:I,render:function(e){return e(L)}}).$mount("#app")},"57b0":function(e,t,n){},"810c":function(e,t,n){"use strict";var s=n("363a"),a=n.n(s);a.a},"85ec":function(e,t,n){}});
//# sourceMappingURL=app.b1d5034e.js.map