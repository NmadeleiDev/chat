(function(e){function t(t){for(var r,a,i=t[0],c=t[1],u=t[2],l=0,h=[];l<i.length;l++)a=i[l],Object.prototype.hasOwnProperty.call(s,a)&&s[a]&&h.push(s[a][0]),s[a]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);d&&d(t);while(h.length)h.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,a=1;a<n.length;a++){var i=n[a];0!==s[i]&&(r=!1)}r&&(o.splice(t--,1),e=c(c.s=n[0]))}return e}var r={},a={app:0},s={app:0},o=[];function i(e){return c.p+"js/"+({about:"about"}[e]||e)+"."+{about:"073a1929"}[e]+".js"}function c(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.e=function(e){var t=[],n={about:1};a[e]?t.push(a[e]):0!==a[e]&&n[e]&&t.push(a[e]=new Promise((function(t,n){for(var r="css/"+({about:"about"}[e]||e)+"."+{about:"15910bbf"}[e]+".css",s=c.p+r,o=document.getElementsByTagName("link"),i=0;i<o.length;i++){var u=o[i],l=u.getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(l===r||l===s))return t()}var h=document.getElementsByTagName("style");for(i=0;i<h.length;i++){u=h[i],l=u.getAttribute("data-href");if(l===r||l===s)return t()}var d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.onload=t,d.onerror=function(t){var r=t&&t.target&&t.target.src||s,o=new Error("Loading CSS chunk "+e+" failed.\n("+r+")");o.code="CSS_CHUNK_LOAD_FAILED",o.request=r,delete a[e],d.parentNode.removeChild(d),n(o)},d.href=s;var p=document.getElementsByTagName("head")[0];p.appendChild(d)})).then((function(){a[e]=0})));var r=s[e];if(0!==r)if(r)t.push(r[2]);else{var o=new Promise((function(t,n){r=s[e]=[t,n]}));t.push(r[2]=o);var u,l=document.createElement("script");l.charset="utf-8",l.timeout=120,c.nc&&l.setAttribute("nonce",c.nc),l.src=i(e);var h=new Error;u=function(t){l.onerror=l.onload=null,clearTimeout(d);var n=s[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;h.message="Loading chunk "+e+" failed.\n("+r+": "+a+")",h.name="ChunkLoadError",h.type=r,h.request=a,n[1](h)}s[e]=void 0}};var d=setTimeout((function(){u({type:"timeout",target:l})}),12e4);l.onerror=l.onload=u,document.head.appendChild(l)}return Promise.all(t)},c.m=e,c.c=r,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)c.d(n,r,function(t){return e[t]}.bind(null,r));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/",c.oe=function(e){throw console.error(e),e};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],l=u.push.bind(u);u.push=t,u=u.slice();for(var h=0;h<u.length;h++)t(u[h]);var d=l;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"034f":function(e,t,n){"use strict";var r=n("8a23"),a=n.n(r);a.a},"0786":function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-alert",{staticClass:"ml-3 mr-3",attrs:{dismissible:"",dense:"",value:e.show,type:e.type}},[e._v(" "+e._s(e.text)+" ")])},a=[],s=n("2b0e"),o=s["a"].extend({name:"CommonNotification",computed:{show:{get:function(){return this.$store.getters.isShown()},set:function(e){this.$store.dispatch("setCommonNotificationValue",e)}},text:function(){return this.$store.getters.notificationText()},type:function(){return this.$store.getters.notificationType()}}}),i=o,c=n("2877"),u=n("6544"),l=n.n(u),h=n("0798"),d=Object(c["a"])(i,r,a,!1,null,"7d4e5509",null);t["a"]=d.exports;l()(d,{VAlert:h["a"]})},"8a23":function(e,t,n){},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",[n("router-view")],1)},s=[],o=r["a"].extend({name:"App",components:{},data:function(){return{}}}),i=o,c=(n("034f"),n("2877")),u=n("6544"),l=n.n(u),h=n("7496"),d=Object(c["a"])(i,a,s,!1,null,null,null),p=d.exports;l()(d,{VApp:h["a"]});var m=n("9483");Object(m["a"])("".concat("/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});n("d3b7");var f=n("8c4f"),g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"default-dark-db fill-height"},[n("LoginAppBar"),n("v-main",{staticClass:"default-dark-db fill-height"},[n("v-container",{attrs:{fluid:""}},[n("v-card",{staticClass:"w-auto h-100 default-dark-db",attrs:{color:"#f6f6f6",elevation:"0"}},[n("CommonNotification"),n("v-card-title",{staticClass:"mt-4 d-flex flex-row justify-center"},[n("h2",[e._v(" Welcome back! ")])]),n("v-card-text",[n("transition",{attrs:{"enter-active-class":"animate__bounceInLeft"}},[e.shownFields?n("v-text-field",{attrs:{placeholder:"Login",color:"green"},model:{value:e.login,callback:function(t){e.login=t},expression:"login"}}):e._e()],1),n("transition",{attrs:{"enter-active-class":"animate__bounceInRight"}},[e.shownFields?n("v-text-field",{attrs:{placeholder:"Password",color:"green",type:"password"},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}):e._e()],1),n("transition",{attrs:{"enter-active-class":"animate__bounceInLeft"}},[!e.isLogin&&e.shownFields?n("v-text-field",{attrs:{placeholder:"Verify password",type:"password",color:"green"},model:{value:e.verifyPassword,callback:function(t){e.verifyPassword=t},expression:"verifyPassword"}}):e._e()],1)],1),n("v-card-actions",{staticClass:"d-flex flex-row justify-center"},[n("v-btn",{attrs:{large:"",disabled:!e.isInputValid,color:e.isInputValid?"green":"black"},on:{click:function(t){return e.passThrough()}}},[e._v(" "+e._s(e.isLogin?"Sign in":"Sign up")+" ")])],1)],1)],1)],1),n("v-footer",{attrs:{app:""}},[n("v-banner",{staticClass:"mb-2 d-block ml-auto mr-auto"},[e._v(" "+e._s(e.isLogin?"Don't have an account yet?":"Already have an account?")+" "),n("v-btn",{attrs:{text:""},on:{click:function(t){e.isLogin=!e.isLogin}}},[e._v(" "+e._s(e.isLogin?"Sign up":"Sign in")+" ")])],1)],1)],1)},v=[],b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app-bar",{attrs:{app:"",color:"accent-4",dark:""}},[n("v-toolbar-title",[e._v("Sign in to Enchat")]),n("v-spacer")],1)},y=[],w=r["a"].extend({name:"LoginAppBar"}),k=w,C=n("40dc"),x=n("2fa4"),O=n("2a7f"),j=Object(c["a"])(k,b,y,!1,null,"67d9f0bc",null),S=j.exports;l()(j,{VAppBar:C["a"],VSpacer:x["a"],VToolbarTitle:O["a"]});var N=n("0786"),I=r["a"].extend({name:"Login",components:{LoginAppBar:S,CommonNotification:N["a"]},data:function(){return{login:"",password:"",verifyPassword:"",isLogin:!0,shownFields:!1}},created:function(){this.$store.dispatch("findLocalKeys").then((function(e){!0===e&&B.push("/home")}))},mounted:function(){this.shownFields=!0},methods:{passThrough:function(){this.isLogin?this.$store.dispatch("signIn",{login:this.login,password:this.password}).then((function(e){!0===e&&B.push("/home")})):this.$store.dispatch("signUp",{login:this.login,password:this.password}).then((function(e){!0===e&&B.push("/home")}))}},computed:{isInputValid:function(){return this.isLogin?""!==this.login&&""!==this.password:""!==this.login&&""!==this.password&&this.password===this.verifyPassword}}}),R=I,T=(n("eeb1"),n("e4e5")),E=n("8336"),F=n("b0af"),L=n("99d9"),P=n("a523"),_=n("553a"),A=n("f6c4"),U=n("8654"),V=Object(c["a"])(R,g,v,!1,null,null,null),D=V.exports;l()(V,{VBanner:T["a"],VBtn:E["a"],VCard:F["a"],VCardActions:L["a"],VCardText:L["c"],VCardTitle:L["d"],VContainer:P["a"],VFooter:_["a"],VMain:A["a"],VTextField:U["a"]}),r["a"].use(f["a"]);var M=[{path:"/",name:"Login",component:D},{path:"/home",name:"Home",component:function(){return n.e("about").then(n.bind(null,"cbe8"))}},{path:"/users",name:"All users",component:function(){return n.e("about").then(n.bind(null,"4ca1"))}},{path:"/chat/:id",name:"Chat here",component:function(){return n.e("about").then(n.bind(null,"5c2b"))}}],K=new f["a"]({routes:M}),B=K,q=n("2f62"),$=n("675f"),J=(n("96cf"),n("1da1")),W=n("bee2"),Y=n("262e"),z=n("2caf"),G=n("d4ec"),H=(n("a15b"),n("d81d"),n("b64b"),n("bc3a")),Q=n.n(H);function X(e){return Object.keys(e).map((function(t){return t+"="+e[t]})).join("&")}function Z(e,t){return t?"/api/media/"+e:"/api/v1/"+e}var ee=function(){var e=Object(J["a"])(regeneratorRuntime.mark((function e(t){var n,r,a,s,o=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:null,r=Z(t,!1),n&&(r+="?"+X(n)),e.prev=3,e.next=6,Q.a.get(r,{headers:{mobile:"true"}});case 6:a=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e["catch"](3),console.log("Request get error: ",e.t0),e.abrupt("return",{status:!1,data:null});case 13:return s=a.data.status,!0!==s&&console.log(a),e.abrupt("return",a.data);case 16:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t){return e.apply(this,arguments)}}(),te=function(){var e=Object(J["a"])(regeneratorRuntime.mark((function e(t,n,r){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=Z(t,!1),e.prev=1,e.next=4,Q.a.post(a,n,{headers:{mobile:"true","Event-date":r}});case 4:s=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e["catch"](1),console.log("Request post error: ",e.t0),e.abrupt("return",{status:!1,data:null});case 11:return!0!==s.data.status&&console.log("failed response: ",s),e.abrupt("return",s.data);case 13:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n,r){return e.apply(this,arguments)}}(),ne=function(){var e=Object(J["a"])(regeneratorRuntime.mark((function e(t,n,r){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=Z(t,!1),e.prev=1,e.next=4,Q.a.put(a,n,{headers:{mobile:"true","Event-date":r}});case 4:s=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e["catch"](1),console.log("Request put error: ",e.t0),e.abrupt("return",{status:!1,data:null});case 11:return!0!==s.data.status&&console.log("failed response: ",s),e.abrupt("return",s.data);case 13:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n,r){return e.apply(this,arguments)}}(),re=function(){var e=Object(J["a"])(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=Z(t,!0),e.prev=1,e.next=4,Q.a.post(r,n,{headers:{"Content-Type":"multipart/form-data",mobile:"true"}});case 4:a=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e["catch"](1),console.log("Request put error: ",e.t0),e.abrupt("return",{status:!1,data:null});case 11:return!0!==a.data.status&&console.log("failed response: ",a),e.abrupt("return",a.data);case 13:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n){return e.apply(this,arguments)}}(),ae=function(){var e=Object(J["a"])(regeneratorRuntime.mark((function e(t){var n,r,a,s=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:null,r=Z(t,!0),n&&(r+="?"+X(n)),e.prev=3,e.next=6,Q.a.get(r,{headers:{mobile:"true"},responseType:"blob"});case 6:a=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e["catch"](3),console.log("Request get error: ",e.t0),e.abrupt("return",{status:!1,data:null});case 13:return console.log("Got response: ",a),e.abrupt("return",a.data);case 15:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t){return e.apply(this,arguments)}}(),se={get:ee,put:ne,post:te,upload:re,download:ae},oe=(n("25f0"),n("6c27")),ie=function(e){return Object(oe["sha256"])([e.username,e.password,e.username].join("&-")).toString()},ce=function(e){return Object(oe["sha256"])([e.username,e.timeStamp,e.sessionKey,e.userSecret].join("")).toString()},ue=function(e){return Object(oe["sha224"])(e)},le={generateToken:ce,generateUserSecret:ie,getSha224:ue},he=function e(){Object(G["a"])(this,e),this.isLogged=!1},de=function(e){Object(Y["a"])(n,e);var t=Object(z["a"])(n);function n(){return Object(G["a"])(this,n),t.apply(this,arguments)}return Object(W["a"])(n,[{key:"isLogged",get:function(){return this.state.isLogged}}]),n}($["b"]),pe=function(e){Object(Y["a"])(n,e);var t=Object(z["a"])(n);function n(){return Object(G["a"])(this,n),t.apply(this,arguments)}return Object(W["a"])(n,[{key:"setLoginState",value:function(e){this.state.isLogged=e}}]),n}($["d"]),me=function(e){Object(Y["a"])(n,e);var t=Object(z["a"])(n);function n(){return Object(G["a"])(this,n),t.apply(this,arguments)}return Object(W["a"])(n,[{key:"signUp",value:function(){var e=Object(J["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.password=le.getSha224(t.password),e.next=3,se.post("signup",{data:{username:t.login,password:t.password},auth:null},"");case 3:if(n=e.sent,!0!==n.status){e.next=11;break}return localStorage.setItem("username",t.login),localStorage.setItem("sessionKey",n.data.token),localStorage.setItem("userSecret",le.generateUserSecret({username:t.login,password:t.password})),this.commit("setLoginState",!0),console.log("Signed up successfully: ",localStorage.getItem("sessionKey"),localStorage.getItem("userSecret")),e.abrupt("return",!0);case 11:return Be.dispatch("showCommonNotification",{text:"Sign up failed. Please, try again.",type:"error"}).catch(console.error),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"signIn",value:function(){var e=Object(J["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.password=le.getSha224(t.password),e.next=3,se.post("signin",{data:{username:t.login,password:t.password},auth:null},"");case 3:if(n=e.sent,!0!==n.status){e.next=11;break}return localStorage.setItem("username",t.login),localStorage.setItem("sessionKey",n.data.token),localStorage.setItem("userSecret",le.generateUserSecret({username:t.login,password:t.password})),this.commit("setLoginState",!0),console.log("Signed in successfully: ",localStorage.getItem("sessionKey"),localStorage.getItem("userSecret")),e.abrupt("return",!0);case 11:return Be.dispatch("showCommonNotification",{text:"Sign in failed. Please, try again.",type:"error"}).catch(console.error),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"findLocalKeys",value:function(){var e=Object(J["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=localStorage.getItem("sessionKey"),n=localStorage.getItem("userSecret"),!t||!n||""===n||""===t){e.next=6;break}return console.log("Keys found in storage"),this.commit("setLoginState",!0),e.abrupt("return",!0);case 6:return console.log("Keys not found in storage"),e.abrupt("return",!1);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),n}($["a"]),fe=new $["c"]({namespaced:!1,state:he,getters:de,mutations:pe,actions:me}),ge=(n("4160"),n("a434"),n("159b"),function e(){Object(G["a"])(this,e),this.id="",this.username="",this.email="",this.pool="",this.token="",this.userSecret="",this.allUsers=[]}),ve=function(e){Object(Y["a"])(n,e);var t=Object(z["a"])(n);function n(){return Object(G["a"])(this,n),t.apply(this,arguments)}return Object(W["a"])(n,[{key:"username",value:function(){return this.state.username}},{key:"email",value:function(){return this.state.email}},{key:"pool",value:function(){return this.state.pool}},{key:"allUsers",value:function(){return this.state.allUsers}},{key:"getNewToken",value:function(e){return le.generateToken({username:this.state.username,timeStamp:e,sessionKey:this.state.token,userSecret:this.state.userSecret})}}]),n}($["b"]),be=function(e){Object(Y["a"])(n,e);var t=Object(z["a"])(n);function n(){return Object(G["a"])(this,n),t.apply(this,arguments)}return Object(W["a"])(n,[{key:"setToken",value:function(e){null!==e?this.state.token=e:(console.log("Error!!! Token not found!"),Be.dispatch("showCommonNotification",{text:"Your authorization is not valid. Please, try to logout and login again.",type:"error"}).catch(console.error))}},{key:"setUserSecret",value:function(e){null!==e?this.state.userSecret=e:(Be.dispatch("showCommonNotification",{text:"Your authorization is not valid. Please, try to logout and login again.",type:"error"}).catch(console.error),console.log("Error!!! User Secret not found!"))}},{key:"setUsername",value:function(e){null!==e&&(this.state.username=e)}},{key:"setEmail",value:function(e){this.state.email=e}},{key:"setPool",value:function(e){this.state.pool=e}},{key:"setAllUsers",value:function(e){var t=this;this.state.allUsers.splice(0,this.state.allUsers.length),e.forEach((function(e){t.state.allUsers.push(e)}))}}]),n}($["d"]),ye=function(e){Object(Y["a"])(n,e);var t=Object(z["a"])(n);function n(){return Object(G["a"])(this,n),t.apply(this,arguments)}return Object(W["a"])(n,[{key:"loadDataLocalStorage",value:function(){this.commit("setUsername",localStorage.getItem("username")),this.commit("setToken",localStorage.getItem("sessionKey")),this.commit("setUserSecret",localStorage.getItem("userSecret"))}},{key:"initUserState",value:function(){var e=Object(J["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.dispatch("loadDataLocalStorage"),t=Date.now().toString(),e.next=4,se.post("user",{data:null,auth:{username:this.state.username,token:le.generateToken({username:this.state.username,timeStamp:t,sessionKey:this.state.token,userSecret:this.state.userSecret})}},t);case 4:if(n=e.sent,!0===n.status){e.next=9;break}return console.log("Failed to get user data!"),Be.dispatch("showCommonNotification",{text:"Error loading your data. Please, try to login again.",type:"error"}).catch(console.error),e.abrupt("return");case 9:return this.commit("setEmail",n.data.email),this.commit("setPool",n.data.poolId),this.dispatch("loadAllUsers"),e.next=14,Be.dispatch("setAllChats",n.data.chats);case 14:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadAllUsers",value:function(){var e=Object(J["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.dispatch("loadDataLocalStorage"),t=Date.now().toString(),e.next=4,se.post("all_users",{data:null,auth:{username:this.state.username,token:le.generateToken({username:this.state.username,timeStamp:t,sessionKey:this.state.token,userSecret:this.state.userSecret})}},t);case 4:if(n=e.sent,!0===n.status){e.next=9;break}return console.log("Failed to get users!"),Be.dispatch("showCommonNotification",{text:"Error loading users",type:"error"}).catch(console.error),e.abrupt("return");case 9:this.commit("setAllUsers",n.data);case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"logInToPool",value:function(){var e=Object(J["a"])(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=Date.now().toString(),e.next=3,se.post("pool",{data:t,auth:{username:this.state.username,token:le.generateToken({username:this.state.username,timeStamp:n,sessionKey:this.state.token,userSecret:this.state.userSecret})}},n);case 3:if(r=e.sent,!0===r.status){e.next=8;break}return console.log("Failed to log in to pool"),Be.dispatch("showCommonNotification",{text:"Error logging to pool.",type:"error"}).catch(console.error),e.abrupt("return");case 8:this.commit("setPool",t.poolId);case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"createPool",value:function(){var e=Object(J["a"])(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=Date.now().toString(),e.next=3,se.put("pool",{data:t,auth:{username:this.state.username,token:le.generateToken({username:this.state.username,timeStamp:n,sessionKey:this.state.token,userSecret:this.state.userSecret})}},n);case 3:if(r=e.sent,!0===r.status){e.next=8;break}return console.log("Failed to log in to pool"),Be.dispatch("showCommonNotification",{text:"Error logging to pool.",type:"error"}).catch(console.error),e.abrupt("return");case 8:this.commit("setPool",t.poolId);case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}]),n}($["a"]),we=new $["c"]({namespaced:!1,state:ge,getters:ve,mutations:be,actions:ye}),ke=(n("7db0"),n("c740"),n("45fc"),n("b0c0"),n("3ca3"),n("ddb0"),n("6821")),Ce=n.n(ke),xe=function e(){Object(G["a"])(this,e),this.isNew=!1,this.chats=[],this.currentChat={id:"",admin:"",name:"",usernames:[],messages:[],storePeriod:24},this.loadedFiles=[],this.generateMessageId=function(){return Ce()(Date.now()+Math.random())}},Oe=function(e){Object(Y["a"])(n,e);var t=Object(z["a"])(n);function n(){return Object(G["a"])(this,n),t.apply(this,arguments)}return Object(W["a"])(n,[{key:"getCurrentChat",value:function(){var e=this;return this.state.isNew?this.state.currentChat:this.state.chats.find((function(t){return t.id===e.state.currentChat.id}))}},{key:"getLoadedFiles",value:function(){return this.state.loadedFiles}},{key:"getAllChats",value:function(){return this.state.chats}},{key:"isNew",value:function(){return this.state.isNew}},{key:"getChatById",value:function(e){var t=this.state.chats.find((function(t){return t.id===e}));return void 0===t?{id:"",name:"Chat",messages:[],usernames:[Be.getters.username()],admin:Be.getters.username(),storePeriod:24}:t}}]),n}($["b"]),je=function(e){Object(Y["a"])(n,e);var t=Object(z["a"])(n);function n(){return Object(G["a"])(this,n),t.apply(this,arguments)}return Object(W["a"])(n,[{key:"sortChats",value:function(){this.state.chats.sort((function(e,t){return e.messages.length>0&&t.messages.length>0?t.messages[t.messages.length-1].date-e.messages[e.messages.length-1].date:1}))}},{key:"addLoadedFile",value:function(e){this.state.loadedFiles.push(e)}},{key:"setChats",value:function(e){var t=this;this.state.chats.splice(0,this.state.chats.length),e.forEach((function(e){t.state.chats.push(e)}))}},{key:"addMessageToItsChat",value:function(e){this.state.chats.forEach((function(t){if(t.id===e.chatId){var n=t.messages.findIndex((function(t){return t.id===e.id}));n<0?t.messages.push(e):(t.messages[n].text=e.text,t.messages[n].state=e.state)}})),console.log("Message added: ",e)}},{key:"addMessageToCurrentChat",value:function(e){try{this.state.currentChat.messages.push(e)}catch(t){console.log("Failed to push to current chat: ",t)}}},{key:"addChat",value:function(e){console.log("Adding chat: ",e),void 0===e.messages&&(e.messages=new Array),void 0===this.state.chats.find((function(t){return t.id===e.id}))&&this.state.chats.push(e)}},{key:"setCurrentChat",value:function(e){this.state.currentChat=e}},{key:"setCurrentChatId",value:function(e){this.state.currentChat.id=e}},{key:"setChatData",value:function(e){var t=this.state.chats.find((function(t){return t.id===e.id}));void 0!==t?(t.name=e.name,t.usernames=e.usernames,t.admin=e.admin):this.state.chats.push(e)}},{key:"setCurrentChatName",value:function(e){var t=this;if(this.state.isNew)this.state.currentChat.name=e;else{var n=this.state.chats.find((function(e){return e.id===t.state.currentChat.id}));void 0!==n&&(n.name=e)}}},{key:"setNewValue",value:function(e){this.state.isNew=e}},{key:"setMessageState",value:function(e){e.message.state=e.state}},{key:"setCurrentChatStorePeriod",value:function(e){this.state.currentChat.storePeriod=e}}]),n}($["d"]),Se=function(e){Object(Y["a"])(n,e);var t=Object(z["a"])(n);function n(){return Object(G["a"])(this,n),t.apply(this,arguments)}return Object(W["a"])(n,[{key:"sendMessageInChat",value:function(){var e=Object(J["a"])(regeneratorRuntime.mark((function e(t){var n,r,a,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n={id:this.state.generateMessageId(),sender:Be.getters.username(),chatId:this.state.currentChat.id,date:Date.now(),state:1,text:t.message,attachedFileIds:[]},!this.state.isNew){e.next=26;break}if(console.log("Chat is new, creating"),this.commit("addMessageToCurrentChat",n),r=this.getters.getCurrentChat(),void 0===r){e.next=21;break}return e.prev=6,e.next=9,this.dispatch("createChat",r);case 9:r=e.sent,e.next=17;break;case 12:return e.prev=12,e.t0=e["catch"](6),console.log("Error creating chat: ",e.t0),Be.dispatch("showCommonNotification",{text:"Error creating chat.",type:"error"}).catch(console.error),e.abrupt("return");case 17:this.commit("setCurrentChat",r),this.commit("setNewValue",!1),e.next=23;break;case 21:console.log("Current chat not found, wtf?"),Be.dispatch("showCommonNotification",{text:"Error creating chat.",type:"error"}).catch(console.error);case 23:this.commit("addMessageToItsChat",n),e.next=29;break;case 26:console.log("Sending files: ",t.files),a=new Promise((function(e,r){if(Array.isArray(t.files)&&t.files.length>0){var a=0;t.files.forEach((function(o){s.dispatch("uploadFile",{file:o,chatId:n.chatId}).then((function(r){""!==r?(console.log("File upload succeeded! Id = "+r),n.attachedFileIds.push(r),a++,(!t.files||a>=t.files.length)&&(console.log("Completed!"),e())):console.log("Error! File id is empty")})).catch((function(e){return r(e)}))}))}else e()})),a.then(Object(J["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Be.dispatch("sendSocketMessage",{type:1,message:n});case 3:s.commit("addMessageToItsChat",n),e.next=10;break;case 6:e.prev=6,e.t0=e["catch"](0),console.log("Error sending message: ",e.t0),Be.dispatch("showCommonNotification",{text:"Error sending message.",type:"error"}).catch(console.error);case 10:case"end":return e.stop()}}),e,null,[[0,6]])})))).catch(console.warn);case 29:case"end":return e.stop()}}),e,this,[[6,12]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"uploadFile",value:function(){var e=Object(J["a"])(regeneratorRuntime.mark((function e(t){var n,r,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=Date.now().toString(),e.next=3,se.post("file",{data:t.chatId,auth:{username:Be.getters.username(),token:Be.getters.getNewToken(n)}},n);case 3:if(r=e.sent,console.log("Lot request: ",r),!(!0!==r.status||r.data<0)){e.next=9;break}return console.log("Failed request to upload"),Be.dispatch("showCommonNotification",{text:"Error loading file.",type:"error"}).catch(console.error),e.abrupt("return","");case 9:return a=new FormData,a.append("save_key",r.data),a.append("file",t.file),e.next=14,se.upload("file",a);case 14:if(s=e.sent,console.log("Upload request: ",s),!0===s.status){e.next=20;break}return console.log("Failed to upload file"),Be.dispatch("showCommonNotification",{text:"Error uploading file.",type:"error"}).catch(console.error),e.abrupt("return","");case 20:return this.commit("addLoadedFile",{id:r.data,file:t.file}),e.abrupt("return",r.data.toString());case 22:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"createChat",value:function(){var e=Object(J["a"])(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=Date.now().toString(),e.next=3,se.post("chat",{data:t,auth:{username:Be.getters.username(),token:Be.getters.getNewToken(n)}},n);case 3:if(r=e.sent,!0===r.status){e.next=8;break}return console.log("Failed to send init message! Failed to create chat!"),Be.dispatch("showCommonNotification",{text:"Chat is not created, please, try again.",type:"error"}).catch(console.error),e.abrupt("return",t);case 8:return a={id:r.data.id,admin:r.data.admin,name:r.data.name,usernames:r.data.usernames,messages:t.messages,storePeriod:24},this.commit("addChat",a),e.abrupt("return",a);case 11:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setCurrentChat",value:function(){var e=Object(J["a"])(regeneratorRuntime.mark((function e(t){var n,r,a,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.isNew?(n=t.data,r={id:"",name:Be.getters.username()+" and "+n.username,usernames:[Be.getters.username(),n.username],admin:Be.getters.username(),messages:[],storePeriod:24},this.commit("setNewValue",!0),this.commit("setCurrentChat",r)):(a=t.data,this.commit("setCurrentChat",a),this.commit("setNewValue",!1),a.messages.forEach((function(e){e.sender!==Be.getters.username()&&e.state<3&&(s.commit("setMessageState",{message:e,state:3}),Be.dispatch("sendSocketMessage",{type:2,message:e}))})),this.dispatch("loadChatImages",a));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"loadChatImages",value:function(){var e=Object(J["a"])(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:t.messages.forEach((function(e){Array.isArray(e.attachedFileIds)&&e.attachedFileIds.length>0&&e.attachedFileIds.forEach(function(){var e=Object(J["a"])(regeneratorRuntime.mark((function e(t){var r,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!n.getters.getLoadedFiles().some((function(e){return e.id===t}))){e.next=2;break}return e.abrupt("return");case 2:return r=Date.now().toString(),e.next=5,se.put("file",{data:t,auth:{username:Be.getters.username(),token:Be.getters.getNewToken(r)}},r);case 5:if(a=e.sent,!0===a.status){e.next=9;break}return console.log("Error getting view token"),e.abrupt("return");case 9:return e.next=11,se.download("file",{file:t,key:a.data});case 11:s=e.sent,n.commit("addLoadedFile",{id:t,file:s});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}));case 3:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setAllChats",value:function(){var e=Object(J["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map(function(){var e=Object(J["a"])(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=Date.now().toString(),e.next=3,se.post("messages",{data:t,auth:{username:Be.getters.username(),token:Be.getters.getNewToken(n)}},n);case 3:if(r=e.sent,!0===r.status){e.next=7;break}return console.log("Error loading messages"),e.abrupt("return");case 7:t.messages=r.data?r.data:[],t.messages.forEach((function(e){return e.chatId=t.id}));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:this.commit("setChats",t),this.commit("sortChats");case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"saveCurrentChatName",value:function(e){this.commit("setCurrentChatName",e);var t=this.getters.getCurrentChat();if(void 0!==t){var n=Date.now().toString();se.post("name",{data:{id:t.id,name:t.name},auth:{username:Be.getters.username(),token:Be.getters.getNewToken(n)}},n).catch(console.warn)}}},{key:"addUserToCurrentChat",value:function(){var e=Object(J["a"])(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=Date.now().toString(),e.next=3,se.post("add",{auth:{username:Be.getters.username(),token:Be.getters.getNewToken(n)},data:{user:{username:t},chat:this.getters.getCurrentChat()}},n);case 3:if(r=e.sent,!0===r.status){e.next=7;break}return console.log("Error add to chat: ",r.data),e.abrupt("return",!1);case 7:return e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setCurrentChatId",value:function(e){this.commit("setCurrentChatId",e)}},{key:"setCurrentChatStorePeriod",value:function(){var e=Object(J["a"])(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=Date.now().toString(),r=this.getters.getCurrentChat(),void 0!==r){e.next=5;break}return console.log("Modifying undef chat"),e.abrupt("return");case 5:return e.next=7,se.post("period",{auth:{username:Be.getters.username(),token:Be.getters.getNewToken(n)},data:{id:r.id,name:r.name,storePeriod:t}},n);case 7:if(a=e.sent,!0===a.status){e.next=11;break}return console.log("Error save period: ",a.data),e.abrupt("return",!1);case 11:this.commit("setCurrentChatStorePeriod",t);case 12:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}]),n}($["a"]),Ne=new $["c"]({namespaced:!1,state:xe,getters:Oe,mutations:je,actions:Se}),Ie=n("7e3c").w3cwebsocket,Re=1,Te=2,Ee=function e(){Object(G["a"])(this,e),this.isConnected=!1},Fe=function(e){Object(Y["a"])(n,e);var t=Object(z["a"])(n);function n(){return Object(G["a"])(this,n),t.apply(this,arguments)}return Object(W["a"])(n,[{key:"isConnected",value:function(){return this.state.isConnected}}]),n}($["b"]),Le=function(e){Object(Y["a"])(n,e);var t=Object(z["a"])(n);function n(){return Object(G["a"])(this,n),t.apply(this,arguments)}return Object(W["a"])(n,[{key:"setClient",value:function(e){this.state.client=e}},{key:"setConnected",value:function(e){this.state.isConnected=e}}]),n}($["d"]),Pe=function(e){Object(Y["a"])(n,e);var t=Object(z["a"])(n);function n(){return Object(G["a"])(this,n),t.apply(this,arguments)}return Object(W["a"])(n,[{key:"sendSocketMessage",value:function(e){void 0!==this.state.client&&this.state.isConnected?this.state.client.send(JSON.stringify(e)):(console.log("Error! IsConnected: ",this.state.isConnected," Client: ",this.state.client),Be.dispatch("showCommonNotification",{text:"Connection error",type:"error"}).catch(console.error))}},{key:"initWebSocket",value:function(){var e=this;if(!this.state.isConnected){var t=Date.now().toString(),n=Be.getters.username(),r=Be.getters.getNewToken(t),a=new Ie("wss://enchat.ga/ws/connect?user="+n+"&token="+r+"&time="+t,"chat");a.onopen=function(){e.dispatch("onOpen")},a.onclose=function(){e.dispatch("onClose")},a.onmessage=function(t){e.dispatch("onMessage",t.data)},a.onerror=function(){console.log("Connection Error"),Be.dispatch("showCommonNotification",{text:"Connection error",type:"error"}).catch(console.error)},this.commit("setClient",a)}}},{key:"onOpen",value:function(){console.log("Opened ws"),this.commit("setConnected",!0)}},{key:"onClose",value:function(){console.log("Closed ws"),this.commit("setConnected",!1)}},{key:"onMessage",value:function(e){console.log("Got message in ws: ",e);var t=JSON.parse(e);if(t.type===Re){var n=t.data;Be.commit("addMessageToItsChat",n),n.sender!==Be.getters.username()&&n.state<3&&this.dispatch("notifyUser",t)}else if(t.type===Te){var r=Date.now().toString(),a=t.data;if(""!==Be.getters.getChatById(a.id).id)return Be.commit("setChatData",a),void console.log("Found and updated chat "+a.name);a.admin!==Be.getters.username()&&(this.dispatch("notifyUser",t),se.post("messages",{data:a,auth:{username:Be.getters.username(),token:Be.getters.getNewToken(r)}},r).then((function(e){!0===e.status?(Array.isArray(e.data)&&(a.messages=e.data),Be.commit("addChat",a)):console.log("Error loading messages")})))}Be.commit("sortChats")}},{key:"notifyUser",value:function(e){var t="",n="",r=[];if(e.type===Re){var a=e.data,s=Be.getters.getChatById(a.chatId);t="New message in "+s.name,n=a.sender+": "+a.text,r=[{action:"open",title:"Open "+s.name}]}else if(e.type===Te){var o=e.data;t="You've been added to chat "+o.name,n="Chat members: "+o.usernames.join(", "),r=[{action:"open",title:"Open "+o.name}]}"granted"===Notification.permission?navigator.serviceWorker.getRegistration().then((function(e){if(void 0!=e){var a={body:n,vibrate:[100,50,100],data:{dateOfArrival:Date.now(),primaryKey:1},actions:r};e.showNotification(t,a).catch(console.warn)}else console.log("only works online")})):Notification.requestPermission((function(e){console.log("Notification permission status:",e)})).catch(console.warn)}}]),n}($["a"]),_e=new $["c"]({namespaced:!1,state:Ee,getters:Fe,mutations:Le,actions:Pe}),Ae=function e(){Object(G["a"])(this,e),this.show=!1,this.type="success",this.text=""},Ue=function(e){Object(Y["a"])(n,e);var t=Object(z["a"])(n);function n(){return Object(G["a"])(this,n),t.apply(this,arguments)}return Object(W["a"])(n,[{key:"isShown",value:function(){return this.state.show}},{key:"notificationText",value:function(){return this.state.text}},{key:"notificationType",value:function(){return this.state.type}}]),n}($["b"]),Ve=function(e){Object(Y["a"])(n,e);var t=Object(z["a"])(n);function n(){return Object(G["a"])(this,n),t.apply(this,arguments)}return Object(W["a"])(n,[{key:"setCommonNotificationValue",value:function(e){this.state.show=e}},{key:"setCommonNotificationText",value:function(e){this.state.text=e}},{key:"setCommonNotificationType",value:function(e){this.state.type=e}}]),n}($["d"]),De=function(e){Object(Y["a"])(n,e);var t=Object(z["a"])(n);function n(){return Object(G["a"])(this,n),t.apply(this,arguments)}return Object(W["a"])(n,[{key:"showCommonNotification",value:function(e){this.commit("setCommonNotificationText",e.text),this.commit("setCommonNotificationType",e.type),this.commit("setCommonNotificationValue",!0)}},{key:"setCommonNotificationValue",value:function(e){this.commit("setCommonNotificationValue",e)}}]),n}($["a"]),Me=new $["c"]({namespaced:!1,state:Ae,getters:Ue,mutations:Ve,actions:De});r["a"].use(q);var Ke=new $["c"]({modules:{Login:fe,UserData:we,Chats:Ne,WebSocket:_e,CommonNotification:Me}}),Be=Object($["e"])(Ke,{strict:!1}),qe=(n("d1e78"),n("f309")),$e=n("0879");r["a"].use(qe["a"]);var Je=new qe["a"]({theme:{themes:{light:{primary:"#ee44aa",secondary:"#424242",accent:"#82B1FF",error:"#FF5252",info:"#2196F3",success:"#4CAF50",warning:"#FFC107"}}},lang:{locales:{ru:$e["a"]},current:"ru"}});r["a"].config.productionTip=!1,new r["a"]({router:B,store:Be,vuetify:Je,render:function(e){return e(p)}}).$mount("#app")},e118:function(e,t,n){},eeb1:function(e,t,n){"use strict";var r=n("e118"),a=n.n(r);a.a}});
//# sourceMappingURL=app.29b3e82b.js.map