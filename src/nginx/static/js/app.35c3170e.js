(function(t){function e(e){for(var n,o,i=e[0],c=e[1],l=e[2],d=0,h=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&h.push(a[o][0]),a[o]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);u&&u(e);while(h.length)h.shift()();return r.push.apply(r,l||[]),s()}function s(){for(var t,e=0;e<r.length;e++){for(var s=r[e],n=!0,i=1;i<s.length;i++){var c=s[i];0!==a[c]&&(n=!1)}n&&(r.splice(e--,1),t=o(o.s=s[0]))}return t}var n={},a={app:0},r=[];function o(e){if(n[e])return n[e].exports;var s=n[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=t,o.c=n,o.d=function(t,e,s){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(s,n,function(e){return t[e]}.bind(null,n));return s},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=e,i=i.slice();for(var l=0;l<i.length;l++)e(i[l]);var u=c;r.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"034f":function(t,e,s){"use strict";var n=s("85ec"),a=s.n(n);a.a},"0909":function(t,e,s){"use strict";var n=s("ba7f"),a=s.n(n);a.a},"106f":function(t,e,s){},4098:function(t,e,s){"use strict";var n=s("e6ad"),a=s.n(n);a.a},"448c":function(t,e,s){},"56d7":function(t,e,s){"use strict";s.r(e);s("e260"),s("e6cf"),s("cca6"),s("a79d");var n=s("2b0e"),a=s("2f62"),r=(s("7db0"),s("4160"),s("b0c0"),s("159b"),s("96cf"),s("1da1")),o=s("bc3a"),i=s.n(o),c=function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var s,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return s=u(e),t.next=3,i.a.get(s);case 3:return a=t.sent,n=a.data.status,!0!==n&&console.log(a),t.abrupt("return",a.data);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),l=function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var s,n,a,r=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return s=r.length>1&&void 0!==r[1]?r[1]:null,n=u(e),t.next=4,i.a.post(n,{data:s});case 4:return a=t.sent,!0!==a.data.status&&console.log("failed response: ",a),t.abrupt("return",a.data);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();function u(t){return"/api/v1/"+t}var d={get:c,post:l},h=1,p=2,f=3,_={state:function(){return{username:"",email:"",contacts:[],chats:[{chat_id:"",name:"",usernames:"",admin:"",messages:[],lastReadMessageId:""}],poolId:""}},mutations:{SET_USER:function(t,e){t.username=e.username,t.email=e.email,t.contacts=e.contacts,e.chats.forEach((function(t){t.messages=[]})),t.chats=e.chats,console.log("User set: ",t)},SET_CHAT_MESSAGES:function(t,e){t.chats.find((function(t){return t.chat_id===e.chat_id})).messages=e.messages},PUSH_MESSAGE:function(t,e){var s;s=t.chats.find((function(t){return t.chat_id===e.chat_id})),void 0!==s.messages&&null!==s.messages||(s.messages=[]),s.messages.push(e)},UPDATE_MESSAGE:function(t,e){var s=t.chats.find((function(t){return t.chat_id===e.chat_id})).messages.find((function(t){return t.id===e.id}));void 0===s&&console.log("Message to update is undefined, wtf??"),s.state=e.state,s.text=e.text,console.log("Updated message ",s)},PUSH_CHAT:function(t,e){e.messages=[],t.chats.push(e)},ADD_USER_TO_CHAT:function(t,e){var s=e.chat,n=e.user;t.chats.find((function(t){return t.chat_id===s.chat_id})).usernames.push(n.username)},SET_CHAT_LAST_READ_MESSAGE_ID:function(t,e){t.chats.find((function(t){return t.chat_id===e.chat_id})).lastReadMessageId=e.id},SET_USER_POOL_ID:function(t,e){t.poolId=e}},actions:{LOAD_USER_DATA:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var s,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,d.get("user");case 2:if(s=t.sent,!0===s.status){t.next=6;break}return console.log("Error loading user data."),t.abrupt("return");case 6:return n=s.data,e.commit("SET_USER",n),n.chats.forEach((function(t){var s=d.post("messages",{chat_id:t.chat_id});s.then((function(s){var n=[];void 0!==s&&null!==s&&!1!==s.status?(s.data.forEach((function(t){n.push(t)})),e.commit("SET_CHAT_MESSAGES",{chat_id:t.chat_id,messages:n})):console.log("Some error in load messages")}))})),t.abrupt("return",!0);case 10:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),RECEIVE_MESSAGE:function(t,e){var s;switch(e.type){case h:if(s=t.state.chats.find((function(t){return t.chat_id===e.data.chat_id})).messages.find((function(t){return t.id===e.data.id})),void 0!==s)return void t.commit("UPDATE_MESSAGE",e.data);t.commit("PUSH_MESSAGE",e.data),e.data.chat_id===t.rootGetters.GET_CURRENT_CHAT_ID&&e.data.sender!==t.state.username&&e.data.status!==f&&(e.data.state=f,t.dispatch("UPDATE_MESSAGE_STATE",e.data),t.dispatch("UPDATE_LAST_READ_MESSAGE",e.data));break;case p:t.commit("PUSH_CHAT",e.data);break;default:console.log("Unknown message type: ",e)}},LEAVE_CHAT:function(t,e){d.post("leave",e).then((function(t){!1===t.status?console.log("Error leaving chat"):location.reload()}))},TRY_JOIN_POOL:function(t,e){d.post("pool_join",e).then((function(s){return!1===s.status?console.log("Error joining pool"):(t.commit("SET_USER_POOL_ID",e.poolId),t.dispatch("LOAD_ALL_USERS")),s.status}))}},getters:{GET_USER:function(t){return t},GET_CURRENT_CHAT:function(t,e){return t.chats.find((function(t){return t.chat_id===e.GET_CURRENT_CHAT_ID}))},GET_MESSAGES:function(t,e){console.log("Message requested");var s=t.chats.find((function(t){return t.chat_id===e.GET_CURRENT_CHAT_ID}));return void 0!==s?(console.log("Returning messages from store: ",s.messages),s.messages):null},GET_CHAT_NAME:function(t,e){console.log("ID: ",e.GET_CURRENT_CHAT_ID);var s=t.chats.find((function(t){return t.chat_id===e.GET_CURRENT_CHAT_ID}));return void 0!==s?s.name:t.newContactName}}},m=_,E=s("6821"),g=1,T=2,C=1,b=3,S=function(){return E(Date.now()+Math.random())},v={state:function(){return{newContactName:"",currentChatId:0}},mutations:{SET_CURRENT_CHAT_ID:function(t,e){t.currentChatId=e,console.log("Current chat set: ",e)},SET_NEW_CONTACT_NAME:function(t,e){t.newContactName=e}},actions:{SEND_SOCKET_MESSAGE:function(t,e){n["default"].prototype.$socket.send(JSON.stringify(e))},CHANGE_NEW_CONTACT_NAME:function(t,e){t.commit("SET_NEW_CONTACT_NAME",e),console.log("Contact name set: ",t.state.newContactName)},CREATE_CHAT:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e,s){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,d.post("chat",s);case 2:if(n=t.sent,!1!==n.status){t.next=6;break}return console.log("server error creating chat"),t.abrupt("return",null);case 6:return t.abrupt("return",n.data);case 7:case"end":return t.stop()}}),t)})));function e(e,s){return t.apply(this,arguments)}return e}(),CHANGE_CURRENT_CHAT:function(t,e){if(t.commit("SET_CURRENT_CHAT_ID",e),null!==e){var s=t.getters.GET_MESSAGES;if(null!==s&&0!==s.length){s.forEach((function(e){if(e.sender!==t.state.username&&e.state!==b){var s=Object.assign({},e);s.state=b,s.chat_id=t.getters.GET_CURRENT_CHAT_ID,t.dispatch("UPDATE_MESSAGE_STATE",s)}}));var n=s[s.length-1];n.sender!==t.state.username&&n.id!==t.getters.GET_CURRENT_CHAT.lastReadMessageId&&(n.chat_id=t.getters.GET_CURRENT_CHAT_ID,t.dispatch("UPDATE_LAST_READ_MESSAGE",n),t.commit("SET_CHAT_LAST_READ_MESSAGE_ID",n))}}},SEND_MESSAGE:function(t,e){var s={type:g,message:{id:S(),sender:t.getters.GET_USER.username,chat_id:t.getters.GET_CURRENT_CHAT_ID,date:Date.now(),state:C,text:e,meta:null,attached_file_path:""}};if(null===t.getters.GET_CURRENT_CHAT_ID){var n={name:t.getters.GET_USER.username+" with "+t.getters.GET_NEW_CONTACT_NAME,admin:t.getters.GET_USER.username,usernames:[t.getters.GET_USER.username,t.getters.GET_NEW_CONTACT_NAME]};console.log("Creating chat: ",n),t.dispatch("CREATE_CHAT",n).then((function(e){null!==e&&(console.log("Created chat: ",e),s.message.chat_id=e.chat_id,t.commit("SET_CURRENT_CHAT_ID",e.chat_id),t.dispatch("SEND_SOCKET_MESSAGE",s),console.log("init message sent: ",s),t.commit("PUSH_MESSAGE",s.message),t.dispatch("UPDATE_LAST_READ_MESSAGE",s.message))}))}else t.dispatch("SEND_SOCKET_MESSAGE",s),console.log("reg message sent: ",s),t.commit("PUSH_MESSAGE",s.message),t.dispatch("UPDATE_LAST_READ_MESSAGE",s.message)},UPDATE_MESSAGE_STATE:function(t,e){var s={type:T,message:e};t.dispatch("SEND_SOCKET_MESSAGE",s)},UPDATE_LAST_READ_MESSAGE:function(t,e){d.post("last",e).then((function(t){!1===t.status&&console.log("server error updating last read message")})),t.commit("SET_CHAT_LAST_READ_MESSAGE_ID",e)},ADD_USER_TO_CHAT:function(t,e){d.post("add",e).then((function(t){!1===t.status&&console.log("server error creating chat")})),t.commit("ADD_USER_TO_CHAT",e)},SAVE_CHAT_NAME:function(t,e){d.post("name",e).then((function(t){!1===t.status&&console.log("server error editing chat")}))},CREATE_POOL:function(t,e){return d.post("pool",e)}},getters:{GET_CURRENT_CHAT_ID:function(t){return t.currentChatId},GET_NEW_CONTACT_NAME:function(t){return t.newContactName},IS_INTERFACE_EMPTY:function(t){return 0===t.newContactName.length&&0===t.currentChatId}}},A=v,w={state:function(){return{allUsers:[]}},mutations:{SET_ALL_USERS:function(t,e){e.forEach((function(e){t.allUsers.push(e)}))}},actions:{LOAD_ALL_USERS:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,d.get("all_users");case 3:return s=t.sent,e.commit("SET_ALL_USERS",s.data),t.abrupt("return",!0);case 8:return t.prev=8,t.t0=t["catch"](0),console.log(t.t0),t.abrupt("return",!1);case 12:case"end":return t.stop()}}),t,null,[[0,8]])})));function e(e){return t.apply(this,arguments)}return e}()},getters:{GET_ALL_USERS:function(t){return t.allUsers}}},O=w,N={state:function(){return{isShown:!1,openedChat:null}},mutations:{SET_SHOWN_STATE:function(t,e){t.isShown=e},SET_CHAT_TO_EDIT:function(t,e){t.openedChat=e}},actions:{SET_EDIT_CHAT_OPENED_STATE:function(t,e){t.commit("SET_SHOWN_STATE",e)},SET_CHAT_TO_EDIT:function(t,e){t.commit("SET_CHAT_TO_EDIT",e)}},getters:{CHAT_TO_EDIT:function(t){return t.openedChat},IS_EDIT_CHAT_SHOWN:function(t){return t.isShown}}},R=N,U={state:function(){return{isShown:!1}},mutations:{SET_SIDEBAR_SHOWN_STATE:function(t,e){t.isShown=e}},actions:{SET_SIDEBAR_OPENED_STATE:function(t,e){t.commit("SET_SIDEBAR_SHOWN_STATE",e)}},getters:{IS_SIDEBAR_SHOWN:function(t){return t.isShown}}},x=U;n["default"].use(a["a"]);var D=new a["a"].Store({strict:!1,modules:{user:m,operational:A,allUsers:O,editChatModal:R,sidebar:x},state:{socket:{isConnected:!1,message:"",reconnectError:!1}},getters:{},mutations:{SOCKET_ONOPEN:function(t,e){n["default"].prototype.$socket=e.currentTarget,t.socket.isConnected=!0,console.log("Connected in store!")},SOCKET_ONCLOSE:function(t,e){t.socket.isConnected=!1},SOCKET_ONERROR:function(t,e){console.error("socket error in store: ",t,e)},SOCKET_RECONNECT:function(t,e){console.info(t,e)},SOCKET_RECONNECT_ERROR:function(t){t.socket.reconnectError=!0}},actions:{}}),M=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("router-view")],1)},I=[],y={name:"App",components:{}},k=y,H=(s("034f"),s("2877")),G=Object(H["a"])(k,M,I,!1,null,null,null),P=G.exports,$=(s("f9e3"),s("2dd8"),s("8c4f")),L=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-container",{attrs:{fluid:""}},[s("b-alert",{attrs:{variant:"danger",dismissible:""},model:{value:t.showAlert,callback:function(e){t.showAlert=e},expression:"showAlert"}},[t._v(" "+t._s(t.alertText)+" ")]),s("b-row",{staticClass:"m-4 mt-5"},[s("b-col",[s("h1",[t._v("Welcome back")])])],1),s("b-row",{staticClass:"m-4"},[s("b-col",[s("label",[t._v(" Имя "),s("b-form-input",{attrs:{size:"lg",placeholder:"Enter your nick"},model:{value:t.user.username,callback:function(e){t.$set(t.user,"username",e)},expression:"user.username"}})],1)])],1),s("b-row",{staticClass:"m-4"},[s("b-col",[s("label",[t._v(" Пароль "),s("b-form-input",{attrs:{size:"lg",state:t.passwordOk,type:"password",placeholder:"Enter your password"},model:{value:t.user.password,callback:function(e){t.$set(t.user,"password",e)},expression:"user.password"}})],1)])],1),s("b-collapse",{staticClass:"mt-2",attrs:{id:"collapse-1"}},[s("b-row",{staticClass:"m-4"},[s("b-col",[s("label",[t._v(" Пароль еще раз "),s("b-form-input",{attrs:{size:"lg",state:t.passwordOk,type:"password",placeholder:"Enter password again"},model:{value:t.passwordVerif,callback:function(e){t.passwordVerif=e},expression:"passwordVerif"}})],1)])],1)],1),s("b-row",{staticClass:"m-4 mt-5"},[s("b-col",[s("b-button",{attrs:{variant:"success",size:"lg",block:t.isMobile},on:{click:function(e){t.isCreate?t.signUp():t.signIn()}}},[t._v(" "+t._s(t.isCreate?"Создать аккаут":"Войти")+" ")])],1)],1),s("b-row",[s("b-col",[s("b-button",{directives:[{name:"b-toggle",rawName:"v-b-toggle.collapse-1",modifiers:{"collapse-1":!0}}],attrs:{variant:"outline-secondary"},on:{click:t.changeAction}},[t._v(" "+t._s(t.isCreate?"У меня есть аккаут":"У меня нет аккаутна")+" ")])],1)],1)],1)},j=[],V={name:"Login",data:function(){return{user:{username:"",password:""},passwordVerif:"",isCreate:!1,showAlert:!1,alertText:!1,isMobile:!0}},created:function(){this.isMobile=window.screen.width>500},methods:{signIn:function(){var t=this,e=this,s=d.post("signin",this.user);s.then((function(s){!0===s.status?e.$router.push("/chat"):(t.showAlert=!0,t.alertText="Имя и пароль не совпадают.")}))},signUp:function(){var t=this,e=this,s=d.post("signup",this.user);s.then((function(s){!0===s.status?e.$router.push("/chat"):(t.showAlert=!0,t.alertText="Не удалось создать аккаунт. Попробуйте позже.")}))},changeAction:function(){this.isCreate=!this.isCreate}},computed:{passwordOk:function(){return this.isCreate&&0!==this.user.password.length?this.user.password===this.passwordVerif:null}}},W=V,B=Object(H["a"])(W,L,j,!1,null,"1474dce8",null),z=B.exports,K=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-container",[s("MobileSidebar",{on:{contact:function(e){return t.setNewChat(e.data)}}}),s("EnterPoolModal"),s("b-button",{directives:[{name:"b-toggle",rawName:"v-b-toggle.sidebar-1",modifiers:{"sidebar-1":!0}}],staticClass:"position-fixed fixed-top",attrs:{squared:"",variant:"primary"}},[t._v("Меню")]),s("b-row",[s("b-col",[s("h4",[t._v("Чат "+t._s(t.chatName))])])],1),s("b-row",[s("b-col",[null!==t.chosenChatMessages?s("div",{staticClass:"messages-container overflow-auto",attrs:{id:"messages-cont"}},t._l(t.chosenChatMessages.concat([]).reverse(),(function(e){return s("div",{key:e.date,class:(e.sender===t.user.username?"right-message":"left-message")+" message-container"},[s("div",{staticClass:"message-header"},[s("div",{staticClass:"message-sender"},[t._v(" "+t._s(e.sender)+" ")]),s("div",{staticClass:"message-date"},[t._v(" "+t._s(t.convertToDatetime(e.date))+" ")])]),s("div",{class:1===e.state?"message-sent":(2===e.state?"message-delivered":"message-read")+" message-text"},[t._v(t._s(e.text))])])})),0):t._e()])],1),s("b-row",{attrs:{"align-content":"center"}},[s("b-col",{attrs:{"align-self":"center"}},[s("div",{staticClass:"input-container w-75 m-auto"},[s("b-input-group",[s("b-input",{staticClass:"message-input",attrs:{placeholder:"Введите сообщение...",type:"text"},model:{value:t.messageText,callback:function(e){t.messageText=e},expression:"messageText"}}),s("b-input-group-append",[s("b-button",{attrs:{variant:"outline-primary"},on:{click:t.sendMessage}},[s("b-icon-envelope")],1)],1)],1)],1)])],1)],1)},J=[],Y=(s("4de4"),s("caad"),s("2532"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-sidebar",{attrs:{width:"380px",id:"sidebar-1",visible:t.isOpened,title:t.userData.username+" menu","no-header-close":t.isNoHeader,shadow:"",backdrop:""},scopedSlots:t._u([{key:"footer",fn:function(e){var n=e.hide;return[s("div",{staticClass:"d-flex bg-dark text-light justify-content-around align-items-center px-3 py-2"},[s("b-button",{attrs:{variant:"outline-warning"},on:{click:t.signOut}},[t._v("Выйти")]),s("b-button",{attrs:{size:"md"},on:{click:n}},[t._v("Закрыть")])],1)]}}])},[s("b-container",{staticClass:"p-0"},[s("b-row",{staticClass:"mb-3 mt-4"},[s("b-col",[t.userData.chats.length>0?s("b-list-group",{staticClass:"w-100"},t._l(t.userData.chats,(function(e){return s("ChatItem",{key:e.chat_id,attrs:{chat:e},on:{click:function(s){return t.emitChat(e)}}})})),1):s("p",[t._v("Чатов пока нет...")])],1)],1),s("b-row",[s("b-col",{staticClass:"m-3"},[s("b-button",{staticClass:"mb-1",attrs:{variant:"primary",block:""},on:{click:function(e){t.isCreateModalOpened=!0}}},[t._v("Create chat")]),s("CreateChatModal",{attrs:{username:t.userData.username,"show-modal":t.isCreateModalOpened},on:{close:function(e){t.isCreateModalOpened=!1}}}),s("b-button",{directives:[{name:"b-toggle",rawName:"v-b-toggle.all-users-cont",modifiers:{"all-users-cont":!0}}],staticClass:"mb-1",attrs:{variant:"info",block:""}},[t._v("Chat with new user")]),s("b-collapse",{attrs:{id:"all-users-cont"}},[s("b-input",{attrs:{placeholder:"Поиск пользователей..."},model:{value:t.findUserText,callback:function(e){t.findUserText=e},expression:"findUserText"}}),t.allUsers.length>0?s("b-list-group",t._l(t.allUsers,(function(e){return s("b-list-group-item",{key:e.username,staticClass:"flex-row align-items-start",on:{click:function(s){return t.emitContact(e)}}},[s("div",{staticClass:"d-flex flex-row align-content-center justify-content-around"},[s("div",{staticClass:"align-self-lg-start"},[s("b-avatar")],1),s("div",[s("h4",[t._v(t._s(e.username))])])])])})),1):t._e()],1)],1)],1)],1),s("EditChatModal",{attrs:{"all-users":t.allUsers,"is-modal-opened":t.isEditModalOpened,"opened-chat":t.openedChat},on:{close:function(e){t.isEditModalOpened=!1},contact:function(e){return t.emitContact(e.data)}}})],1)}),q=[],F=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-modal",{attrs:{id:"create-chat-modal"},model:{value:t.isModalOpened,callback:function(e){t.isModalOpened=e},expression:"isModalOpened"}},[s("b-alert",{attrs:{variant:t.alertVariant,dismissible:""},model:{value:t.showAlert,callback:function(e){t.showAlert=e},expression:"showAlert"}},[t._v(" "+t._s(t.alertText)+" ")]),t.allUsers.length>2?s("div",{staticClass:"d-flex flex-column justify-content-between align-items-center"},[s("h4",{staticClass:"m-2"},[t._v("Create chat")]),s("b-input",{staticClass:"m-2",attrs:{placeholder:"Enter chat name..."},model:{value:t.chatName,callback:function(e){t.chatName=e},expression:"chatName"}}),s("div",{staticClass:"users-container mb-2 mt-2 w-100"},[s("b-input",{staticClass:"mb-2 w-100",attrs:{placeholder:"Search user..."},model:{value:t.findUserName,callback:function(e){t.findUserName=e},expression:"findUserName"}}),s("b-list-group",t._l(t.allUsers.filter((function(e){return e.username.includes(t.findUserName)||t.chosenUsers.includes(e)})),(function(e){return s("b-list-group-item",{key:e.username,attrs:{active:t.chosenUsers.includes(e)},on:{click:function(s){return t.toggleUser(e)}}},[t._v(" "+t._s(e.username)+" ")])})),1)],1),s("b-button",{staticClass:"m-2",attrs:{variant:"success"},on:{click:t.createChat}},[t._v("Create")])],1):s("b-alert",{attrs:{show:""}},[t._v("There is not enough users to create group chat")])],1)},Q=[],X=(s("99af"),s("c975"),s("a15b"),s("d81d"),s("a434"),{name:"CreateChatModal",props:{username:String,showModal:Boolean},data:function(){return{chatName:"",findUserName:"",chosenUsers:[],showAlert:!1,alertVariant:"success",alertText:""}},methods:{createChat:function(){var t=this;if(this.chosenUsers.length<2)return this.showAlert=!0,this.alertVariant="danger",void(this.alertText="Chat must contain more than one person");var e=this.chosenUsers.map((function(t){return t.username})).concat([this.username]),s={name:"group ("+e.join(", ")+")",admin:this.username,usernames:e};this.$store.dispatch("CREATE_CHAT",s).then((function(e){null===e?(console.log("error creating chat"),t.showAlert=!0,t.alertVariant="warning",t.alertText="Error creating chat"):(console.log("created chat: ",e),t.showAlert=!0,t.alertVariant="success",t.alertText="Chat created!")})),this.isModalOpened=!1},toggleUser:function(t){var e=this.chosenUsers.indexOf(t);e>=0?this.chosenUsers.splice(e,1):this.chosenUsers.push(t)}},computed:{isModalOpened:{get:function(){return this.showModal},set:function(){this.$emit("close")}},allUsers:function(){return this.$store.getters.GET_ALL_USERS}}}),Z=X,tt=(s("6ed5"),Object(H["a"])(Z,F,Q,!1,null,"1651a5b7",null)),et=tt.exports,st=function(){var t=this,e=t.$createElement,s=t._self._c||e;return null!==t.openedChat?s("b-modal",{attrs:{id:"chat-settings-modal",title:t.openedChat.name,size:"lg",scrollable:"",centered:"","button-size":"sm"},model:{value:t.isOpened,callback:function(e){t.isOpened=e},expression:"isOpened"}},[s("div",{staticClass:"d-flex flex-column justify-content-around align-items-center"},[s("div",{staticClass:"m-2 d-flex flex-column justify-content-between align-items-center"},[s("b-button",{directives:[{name:"b-toggle",rawName:"v-b-toggle.chat-name-edit",modifiers:{"chat-name-edit":!0}}],staticClass:"mb-1",attrs:{size:"sm",variant:"secondary"}},[t._v("Edit name")]),s("b-collapse",{attrs:{id:"chat-name-edit"}},[s("b-input-group",[s("b-input",{attrs:{placeholder:"Enter new name..."},model:{value:t.editedChatName,callback:function(e){t.editedChatName=e},expression:"editedChatName"}}),s("b-input-group-append",[s("b-button",{attrs:{variant:"primary"},on:{click:t.saveChatName}},[t._v("Save")])],1)],1)],1)],1),s("b-list-group",{staticClass:"w-100"},t._l(t.openedChat.usernames,(function(e){return s("b-list-group-item",{key:e,staticClass:"d-flex justify-content-between align-items-center"},[s("h5",[t._v(t._s(e))]),e===t.openedChat.admin?s("b-badge",{attrs:{variant:"warning",pill:""}},[t._v("Admin")]):t._e()],1)})),1),t.allUsers.length>0?s("div",[s("b-button",{directives:[{name:"b-toggle",rawName:"v-b-toggle.all-users-collapse",modifiers:{"all-users-collapse":!0}}],staticClass:"m-3",attrs:{size:"sm",variant:"primary"}},[s("b-icon-plus"),t._v(" Add users")],1),s("b-collapse",{attrs:{id:"all-users-collapse"}},[s("b-input",{attrs:{placeholder:"Поиск пользователей..."},model:{value:t.findUserText,callback:function(e){t.findUserText=e},expression:"findUserText"}}),t.allUsers.length>0&&null!==t.openedChat?s("b-list-group",t._l(t.allUsers.filter((function(e){return!t.openedChat.usernames.includes(e.username)&&e.username.indexOf(t.findUserText)>=0})),(function(e){return s("b-list-group-item",{key:e.username,staticClass:"d-flex justify-content-between align-items-center",on:{click:function(s){return t.emitContact(e)}}},[s("div",[t._v(" "+t._s(e.username)+" ")]),s("b-button",{attrs:{variant:"info"},on:{click:function(s){return t.addUserToChat(e)}}},[s("b-icon-plus"),t._v(" Add")],1)],1)})),1):t._e()],1)],1):t._e(),s("div",[s("b-button",{attrs:{variant:"outline-danger"},on:{click:t.leaveChat}},[t._v("Leave chat")])],1)],1)]):t._e()},nt=[],at={name:"EditChatModal",data:function(){return{editedChatName:"",findUserText:""}},methods:{saveChatName:function(){var t=this.openedChat;t.name=this.editedChatName,this.$store.dispatch("SAVE_CHAT_NAME",t)},addUserToChat:function(t){if(null!==this.openedChat){var e={chat:this.openedChat,user:t};this.$store.dispatch("ADD_USER_TO_CHAT",e)}},emitContact:function(t){this.$emit("contact",{data:t})},leaveChat:function(){this.$store.dispatch("LEAVE_CHAT",this.openedChat)}},computed:{isOpened:{get:function(){return this.$store.getters.IS_EDIT_CHAT_SHOWN},set:function(t){this.$store.dispatch("SET_EDIT_CHAT_OPENED_STATE",t)}},allUsers:function(){return this.$store.getters.GET_ALL_USERS},openedChat:function(){return this.$store.getters.CHAT_TO_EDIT}}},rt=at,ot=Object(H["a"])(rt,st,nt,!1,null,"da8ff0a0",null),it=ot.exports,ct=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center position-relative"},[s("div",{staticClass:"d-flex justify-content-around flex-row align-content-center align-items-center",on:{click:t.setChat}},[t.chat.usernames.length<=2?s("b-icon-person",{attrs:{"font-scale":"2"}}):s("b-icon-people",{attrs:{"font-scale":"2"}}),s("div",{staticClass:"chat-name-and-message"},[s("div",{staticClass:"chat-name"},[t._v(" "+t._s(t.chat.name)+" ")]),t.chat.messages.length>0?s("div",{staticClass:"chat-last-message"},[t._v(" "+t._s(t.chat.messages[t.chat.messages.length-1].sender)+": "+t._s(t.chat.messages[t.chat.messages.length-1].text)+" ")]):t._e()])],1),s("b-icon-plus",{staticClass:"chat-options-icon",attrs:{"font-scale":"1.5"},on:{click:function(e){return t.openChatSettingsModal(t.chat)}}}),t.getNumberOfUnread>0?s("b-badge",{attrs:{variant:"primary",pill:""}},[t._v(" "+t._s(t.getNumberOfUnread)+" ")]):t._e()],1)},lt=[],ut=(s("c740"),{name:"ChatItem",props:{chat:Object},data:function(){return{openedChat:{}}},created:function(){console.log("CHAT ITEM: ",this.chat)},methods:{openChatSettingsModal:function(t){this.$store.dispatch("SET_CHAT_TO_EDIT",t),this.$store.dispatch("SET_EDIT_CHAT_OPENED_STATE",!0),console.log("opened chat: ",t)},setChat:function(){this.$store.dispatch("CHANGE_CURRENT_CHAT",this.chat.chat_id),this.$store.dispatch("SET_SIDEBAR_OPENED_STATE",!1)}},computed:{getNumberOfUnread:function(){var t=this,e=this.chat.messages.findIndex((function(e){return e.id===t.chat.lastReadMessageId}));return e<0?this.chat.messages.length:this.chat.messages.length-e-1}}}),dt=ut,ht=(s("d433"),Object(H["a"])(dt,ct,lt,!1,null,"786a9129",null)),pt=ht.exports,ft={name:"MobileSidebar",components:{ChatItem:pt,EditChatModal:it,CreateChatModal:et},data:function(){return{findUserText:"",openedChat:null,isEditModalOpened:!1,isCreateModalOpened:!1,editedChatName:""}},methods:{emitContact:function(t){this.$emit("contact",{data:t})},signOut:function(){d.get("signout"),this.$router.push("/login")},openChatSettingsModal:function(t){this.openedChat=t,this.isEditModalOpened=!0,console.log("opened chat: ",t)}},computed:{userData:function(){return this.$store.getters.GET_USER},allUsers:function(){var t=this,e=this.$store.getters.GET_ALL_USERS;return void 0===e||null===e?[]:this.$store.getters.GET_ALL_USERS.filter((function(e){return e.username!==t.userData.username}))},isOpened:{get:function(){return this.$store.getters.IS_SIDEBAR_SHOWN},set:function(){}},isNoHeader:function(){return this.$store.getters.IS_INTERFACE_EMPTY}}},_t=ft,mt=(s("4098"),Object(H["a"])(_t,Y,q,!1,null,"f430bd2c",null)),Et=mt.exports,gt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-modal",{attrs:{title:"You are not logged in to any messaging pool",visible:t.isShown,"no-close-on-esc":"","no-close-on-backdrop":"","hide-header-close":"","cancel-disabled":"","ok-disabled":""}},[s("b-tabs",[s("b-alert",{attrs:{type:t.alert.type,show:t.alert.isShown,dismissible:""}},[t._v(t._s(t.alert.text))]),s("b-tab",{attrs:{title:"Join"}},[s("div",{staticClass:"d-flex flex-column align-items-center justify-content-center"},[s("h4",{staticClass:"m-3"},[t._v("Enter your pool:")]),s("b-input",{staticClass:"m-3",attrs:{placeholder:"Enter your pool..."},model:{value:t.poolId,callback:function(e){t.poolId=e},expression:"poolId"}}),s("b-input",{staticClass:"m-3",attrs:{placeholder:"Enter pool password",type:"password"},model:{value:t.poolPasswd,callback:function(e){t.poolPasswd=e},expression:"poolPasswd"}}),s("b-button",{staticClass:"m-3",on:{click:t.joinPool}},[t._v("Join pool")])],1)]),s("b-tab",{attrs:{title:"Create"}},[s("div",{staticClass:"d-flex flex-column align-items-center justify-content-center"},[s("h4",{staticClass:"m-3"},[t._v("Create pool id and password:")]),s("b-input",{staticClass:"m-3",attrs:{placeholder:"Enter new pool id..."},model:{value:t.poolId,callback:function(e){t.poolId=e},expression:"poolId"}}),s("b-input",{staticClass:"m-3",attrs:{placeholder:"Enter pool password",type:"password"},model:{value:t.poolPasswd,callback:function(e){t.poolPasswd=e},expression:"poolPasswd"}}),s("b-input",{staticClass:"m-3",attrs:{placeholder:"Verify password",type:"password",state:t.poolPasswd===t.poolPasswdVerif},model:{value:t.poolPasswdVerif,callback:function(e){t.poolPasswdVerif=e},expression:"poolPasswdVerif"}}),s("b-button",{staticClass:"m-3",on:{click:t.createPool}},[t._v("Create pool")])],1)])],1)],1)},Tt=[],Ct={name:"EnterPoolModal",data:function(){return{poolId:"",poolPasswd:"",poolPasswdVerif:"",alert:{type:"",text:"",isShown:!1}}},methods:{joinPool:function(){var t=this;this.$store.dispatch("TRY_JOIN_POOL",{poolId:this.poolId,password:this.poolPasswd}).then((function(e){console.log(e),e.status?(t.alert.text="Success",t.alert.type="success",t.alert.isShown=!0):(t.alert.text="Error",t.alert.type="danger",t.alert.isShown=!0)})),this.poolId=this.poolPasswd=this.poolPasswdVerif=""},createPool:function(){var t=this;this.$store.dispatch("CREATE_POOL",{poolId:this.poolId,password:this.poolPasswd}).then((function(e){console.log(e),e.status?(t.alert.text="Success",t.alert.type="success",t.alert.isShown=!0):(t.alert.text="Error",t.alert.type="danger",t.alert.isShown=!0)})),this.poolId=this.poolPasswd=this.poolPasswdVerif=""}},computed:{isShown:function(){return null===this.$store.getters.GET_USER.poolId||0===this.$store.getters.GET_USER.poolId.length}}},bt=Ct,St=Object(H["a"])(bt,gt,Tt,!1,null,"7e5aea63",null),vt=St.exports,At={name:"Chat",components:{EnterPoolModal:vt,MobileSidebar:Et},data:function(){return{messageText:"",findUserText:""}},created:function(){this.$store.dispatch("LOAD_USER_DATA").catch((function(t){return console.log(t)})),this.$store.dispatch("LOAD_ALL_USERS").catch((function(t){return console.log(t)})),this.connection=this.setConnection()},mounted:function(){this.$store.dispatch("SET_SIDEBAR_OPENED_STATE",!0)},beforeDestroy:function(){this.$disconnect()},methods:{sendMessage:function(){this.$store.dispatch("SEND_MESSAGE",this.messageText),this.messageText=""},setConnection:function(){var t=this;this.$connect(),this.$options.sockets.onmessage=function(e){var s=JSON.parse(e.data);t.$store.dispatch("RECEIVE_MESSAGE",s);var n=document.getElementById("messages-cont");n.scrollTop=n.scrollHeight}},setNewChat:function(t){this.$store.dispatch("CHANGE_CURRENT_CHAT",null),this.$store.dispatch("CHANGE_NEW_CONTACT_NAME",t.username),this.$store.dispatch("SET_SIDEBAR_OPENED_STATE",!1)},convertToDatetime:function(t){var e=new Date(t),s=e.getHours(),n="0"+e.getMinutes(),a="0"+e.getSeconds();return s+":"+n.substr(-2)+":"+a.substr(-2)}},computed:{user:function(){return this.$store.getters.GET_USER},allUsers:function(){return this.$store.getters.GET_ALL_USERS},newUsers:function(){var t=this;return this.$store.getters.GET_ALL_USERS.length<1?[]:this.$store.getters.GET_ALL_USERS.filter((function(e){return e.username!==t.user.username&&(null==t.user.contacts||!t.user.contacts.includes(e.username))}))},chosenChatMessages:{get:function(){var t=document.getElementById("messages-cont");return null!==t&&(t.scrollTop=t.scrollHeight),this.$store.getters.GET_MESSAGES},set:function(){}},chatName:function(){return this.$store.getters.GET_CHAT_NAME}}},wt=At,Ot=(s("0909"),Object(H["a"])(wt,K,J,!1,null,"8686b9e0",null)),Nt=Ot.exports;n["default"].use($["a"]);var Rt=[{path:"/",redirect:"/login"},{path:"/login",name:"login_page",meta:{title:"login page"},component:z},{path:"/chat",name:"chat_page",meta:{title:"Chat page"},component:Nt}],Ut=new $["a"]({mode:"history",base:"/",routes:Rt}),xt=Ut,Dt=s("5f5b"),Mt=s("b1e0"),It=s("b408"),yt=s.n(It);n["default"].use(yt.a,"ws://"+window.location.host+"/ws/connect",{connectManually:!0,reconnection:!0,reconnectionAttempts:5},{store:D,protocol:"chat"}),n["default"].use(Dt["a"]),n["default"].use(Mt["a"]),n["default"].config.productionTip=!1,new n["default"]({store:D,router:xt,render:function(t){return t(P)}}).$mount("#app")},"6ed5":function(t,e,s){"use strict";var n=s("106f"),a=s.n(n);a.a},"85ec":function(t,e,s){},ba7f:function(t,e,s){},d433:function(t,e,s){"use strict";var n=s("448c"),a=s.n(n);a.a},e6ad:function(t,e,s){}});
//# sourceMappingURL=app.35c3170e.js.map